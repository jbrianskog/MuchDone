{
  "rules": {
    "users": {
      "$uid": {
        "events": {
          ".read": "$uid === auth.uid",
          ".indexOn": ["version"],
          "$event_id" : {
            ".write": "$uid === auth.uid && !data.exists() && newData.exists()",
            ".validate": "newData.hasChildren(['id', 'aggregateId', 'type', 'version']) && ((newData.child('type').val() === 0 && newData.hasChildren(['todoId', 'todoName'])) || (newData.child('type').val() === 1 && newData.hasChildren(['todoId'])) || (newData.child('type').val() === 2 && newData.hasChildren(['todoId', 'todoCompletionTimestamp'])) || (newData.child('type').val() === 3 && newData.hasChildren(['todoId'])) || (newData.child('type').val() === 4 && newData.hasChildren(['todoId', 'todoName'])) || (newData.child('type').val() === 5 && newData.hasChildren(['todoId', 'todoOffset'])))",
            "id": {
              ".validate": "newData.isString() && newData.val().length === 36"
            },
            "aggregateId": {
              ".validate": "newData.isString() && newData.val().length === 36"
            },
            "type": {
              ".validate": "newData.isNumber()"
            },
            "version": {
              ".validate": "newData.isNumber()"
            },
            "todoId": {
              ".validate": "newData.isString() && newData.val().length === 36"
            },
            "todoName": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 200"
            },
            "todoCompletionTimestamp": {
              ".validate": "newData.isNumber()"
            },
            "todoOffset": {
              ".validate": "newData.isNumber()"
            },
            "$other": { ".validate": false }
          }
        },
        "aggregateEvents" : {
          ".read": "$uid === auth.uid",
          "$aggregate_id" : {
            ".indexOn": ["version"],
            ".validate": "$aggregate_id.length === 36",
            "$event_id" : {
              ".write": "$uid === auth.uid && !data.exists() && newData.exists()",
              ".validate": "newData.hasChildren(['id', 'aggregateId', 'type', 'version']) && ((newData.child('type').val() === 0 && newData.hasChildren(['todoId', 'todoName'])) || (newData.child('type').val() === 1 && newData.hasChildren(['todoId'])) || (newData.child('type').val() === 2 && newData.hasChildren(['todoId', 'todoCompletionTimestamp'])) || (newData.child('type').val() === 3 && newData.hasChildren(['todoId'])) || (newData.child('type').val() === 4 && newData.hasChildren(['todoId', 'todoName'])) || (newData.child('type').val() === 5 && newData.hasChildren(['todoId', 'todoOffset'])))",
              "id": {
                ".validate": "newData.isString() && newData.val().length === 36"
              },
              "aggregateId": {
                ".validate": "newData.isString() && newData.val().length === 36"
              },
              "type": {
                ".validate": "newData.isNumber()"
              },
              "version": {
                ".validate": "newData.isNumber()"
              },
              "todoId": {
                ".validate": "newData.isString() && newData.val().length === 36"
              },
              "todoName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length < 200"
              },
              "todoCompletionTimestamp": {
                ".validate": "newData.isNumber()"
              },
              "todoOffset": {
                ".validate": "newData.isNumber()"
              },
              "$other": { ".validate": false }
            }
          }
        },
        "$other": { ".validate": false }
      }
    }
  }
}