!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=18)}([function(e,t){e.exports=React},function(e,t){e.exports=ReactDOM},function(e,t){e.exports=firebase},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(4);var s;!function(e){e[e.TodoListCreated=0]="TodoListCreated",e[e.TodoAdded=1]="TodoAdded",e[e.TodoRemoved=2]="TodoRemoved",e[e.TodoCompleted=3]="TodoCompleted",e[e.TodoUncompleted=4]="TodoUncompleted",e[e.TodoRenamed=5]="TodoRenamed",e[e.TodoPositionChanged=6]="TodoPositionChanged"}(s=t.DomainEventTypeName||(t.DomainEventTypeName={}));class i{constructor(){this.id=n.v4()}}t.TodoListCreated=class extends i{constructor(e){super(),this.aggregateId=e,this.type=s.TodoListCreated}};t.TodoAdded=class extends i{constructor(e,t,o){super(),this.aggregateId=e,this.todoId=t,this.todoName=o,this.type=s.TodoAdded}};t.TodoRemoved=class extends i{constructor(e,t){super(),this.aggregateId=e,this.todoId=t,this.type=s.TodoRemoved}};t.TodoCompleted=class extends i{constructor(e,t,o){super(),this.aggregateId=e,this.todoId=t,this.todoCompletionTimestamp=o,this.type=s.TodoCompleted}};t.TodoUncompleted=class extends i{constructor(e,t){super(),this.aggregateId=e,this.todoId=t,this.type=s.TodoUncompleted}};t.TodoRenamed=class extends i{constructor(e,t,o){super(),this.aggregateId=e,this.todoId=t,this.todoName=o,this.type=s.TodoRenamed}};t.TodoPositionChanged=class extends i{constructor(e,t,o){super(),this.aggregateId=e,this.todoId=t,this.todoOffset=o,this.type=s.TodoPositionChanged}}},function(e,t,o){var n=o(20),s=o(21),i=s;i.v1=n,i.v4=s,e.exports=i},function(e,t,o){"use strict";o.r(t),o.d(t,"IGNORE_CLASS_NAME",function(){return p});var n=o(0),s=o(1);function i(e,t,o){return e===t||(e.correspondingElement?e.correspondingElement.classList.contains(o):e.classList.contains(o))}var r=function(){if("undefined"!=typeof window&&"function"==typeof window.addEventListener){var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}}),o=function(){};return window.addEventListener("testPassiveEventSupport",o,t),window.removeEventListener("testPassiveEventSupport",o,t),e}};var a,d=function(e){return void 0===e&&(e=0),function(){return++e}}(),l={},c={},u=["touchstart","touchmove"],p="ignore-react-onclickoutside";function h(e,t){var o=null;return-1!==u.indexOf(t)&&a&&(o={passive:!e.props.preventDefault}),o}t.default=function(e,t){var o,u;return u=o=function(o){function u(e){var t;return(t=o.call(this,e)||this).__outsideClickHandler=function(e){if("function"!=typeof t.__clickOutsideHandlerProp){var o=t.getInstance();if("function"!=typeof o.props.handleClickOutside){if("function"!=typeof o.handleClickOutside)throw new Error("WrappedComponent lacks a handleClickOutside(event) function for processing outside click events.");o.handleClickOutside(e)}else o.props.handleClickOutside(e)}else t.__clickOutsideHandlerProp(e)},t.enableOnClickOutside=function(){if("undefined"!=typeof document&&!c[t._uid]){void 0===a&&(a=r()),c[t._uid]=!0;var e=t.props.eventTypes;e.forEach||(e=[e]),l[t._uid]=function(e){t.props.disableOnClickOutside||null!==t.componentNode&&(t.props.preventDefault&&e.preventDefault(),t.props.stopPropagation&&e.stopPropagation(),t.props.excludeScrollbar&&function(e){return document.documentElement.clientWidth<=e.clientX||document.documentElement.clientHeight<=e.clientY}(e)||function(e,t,o){if(e===t)return!0;for(;e.parentNode;){if(i(e,t,o))return!0;e=e.parentNode}return e}(e.target,t.componentNode,t.props.outsideClickIgnoreClass)===document&&t.__outsideClickHandler(e))},e.forEach(function(e){document.addEventListener(e,l[t._uid],h(t,e))})}},t.disableOnClickOutside=function(){delete c[t._uid];var e=l[t._uid];if(e&&"undefined"!=typeof document){var o=t.props.eventTypes;o.forEach||(o=[o]),o.forEach(function(o){return document.removeEventListener(o,e,h(t,o))}),delete l[t._uid]}},t.getRef=function(e){return t.instanceRef=e},t._uid=d(),t}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(u,o);var p=u.prototype;return p.getInstance=function(){if(!e.prototype.isReactComponent)return this;var t=this.instanceRef;return t.getInstance?t.getInstance():t},p.componentDidMount=function(){if("undefined"!=typeof document&&document.createElement){var e=this.getInstance();if(t&&"function"==typeof t.handleClickOutside&&(this.__clickOutsideHandlerProp=t.handleClickOutside(e),"function"!=typeof this.__clickOutsideHandlerProp))throw new Error("WrappedComponent lacks a function for processing outside click events specified by the handleClickOutside config option.");this.componentNode=Object(s.findDOMNode)(this.getInstance()),this.enableOnClickOutside()}},p.componentDidUpdate=function(){this.componentNode=Object(s.findDOMNode)(this.getInstance())},p.componentWillUnmount=function(){this.disableOnClickOutside()},p.render=function(){var t=this.props,o=(t.excludeScrollbar,function(e,t){if(null==e)return{};var o,n,s={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(s[o]=e[o]);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(s[o]=e[o])}return s}(t,["excludeScrollbar"]));return e.prototype.isReactComponent?o.ref=this.getRef:o.wrappedRef=this.getRef,o.disableOnClickOutside=this.disableOnClickOutside,o.enableOnClickOutside=this.enableOnClickOutside,Object(n.createElement)(e,o)},u}(n.Component),o.displayName="OnClickOutside("+(e.displayName||e.name||"Component")+")",o.defaultProps={eventTypes:["mousedown","touchstart"],excludeScrollbar:t&&t.excludeScrollbar||!1,outsideClickIgnoreClass:p,preventDefault:!1,stopPropagation:!1},o.getClass=function(){return e.getClass?e.getClass():e},u}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.CompletedTodoTitle=class extends n.PureComponent{render(){return n.createElement("div",{className:"todo-list-todo-title"},this.props.title,n.createElement("br",null),n.createElement("small",null,"Completed on ",this.props.completionDate.toLocaleDateString()))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoTitle=class extends n.PureComponent{render(){return n.createElement("div",{className:"todo-list-todo-title"},this.props.title)}}},function(e,t){var o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(o){var n=new Uint8Array(16);e.exports=function(){return o(n),n}}else{var s=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),s[t]=e>>>((3&t)<<3)&255;return s}}},function(e,t){for(var o=[],n=0;n<256;++n)o[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,s=o;return[s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],"-",s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]],s[e[n++]]].join("")}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(4),s=o(11),i=o(3);t.TodoList=class extends s.AggregateRoot{get todos(){return this._todos.filter(e=>!e.isCompleted)}get completedTodos(){return this._todos.filter(e=>e.isCompleted).sort((e,t)=>t.completionTimestamp-e.completionTimestamp)}init(){super.init(),this._todos=[],this._todosMap=new Map}TodoAdded(e){this.id||(this._id=e.aggregateId);let t={id:e.todoId,name:e.todoName,isCompleted:!1};this._todos.push(t),this._todosMap.set(e.todoId,t)}TodoRemoved(e){let t=this._todos.findIndex(t=>t.id===e.todoId);-1!==t&&(this._todos.splice(t,1),this._todosMap.delete(e.todoId))}TodoCompleted(e){let t=this._todosMap.get(e.todoId);t&&(t.isCompleted=!0,t.completionTimestamp=e.todoCompletionTimestamp)}TodoUncompleted(e){let t=this._todosMap.get(e.todoId);t&&(t.isCompleted=!1)}TodoRenamed(e){let t=this._todosMap.get(e.todoId);t&&(t.name=e.todoName)}TodoPositionChanged(e){let t=this._todos.reduce((e,t,o)=>(t.isCompleted||e.push(o),e),[]),o=t.findIndex(t=>this._todos[t].id===e.todoId);if(-1===o)return;let n=o+e.todoOffset;if(n<0?n=0:n>t.length-1&&(n=t.length-1),o!==n)if(n<o)for(let e=n;e<o;e++)s(this._todos,t[o],t[e]);else for(let e=n;e>o;e--)s(this._todos,t[o],t[e]);function s(e,t,o){let n=e[t];e[t]=e[o],e[o]=n}}add(e,t){let o=this.id;o||(o=n.v4(),this.applyAndStage(new i.TodoListCreated(o))),this.applyAndStage(new i.TodoAdded(o,e,t))}remove(e){this.id&&this._todosMap.has(e)&&this.applyAndStage(new i.TodoRemoved(this.id,e))}complete(e,t){let o=this._todosMap.get(e);this.id&&o&&!o.isCompleted&&this.applyAndStage(new i.TodoCompleted(this.id,e,t))}uncomplete(e){let t=this._todosMap.get(e);this.id&&t&&t.isCompleted&&this.applyAndStage(new i.TodoUncompleted(this.id,e))}rename(e,t){let o=this._todosMap.get(e);this.id&&o&&o.name!==t&&this.applyAndStage(new i.TodoRenamed(this.id,e,t))}changePosition(e,t){if(!this.id||0===t)return;let o=this.todos.findIndex(t=>t.id===e);-1===o||0===o&&t<1||o===this.todos.length-1&&t>-1||this.applyAndStage(new i.TodoPositionChanged(this.id,e,t))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(3);t.AggregateRoot=class{get uncommittedEvents(){return this._uncommittedEvents}get id(){return this._id}init(){this._uncommittedEvents=[]}constructor(e){this.init();for(const t of e)this.apply(t)}apply(e){let t=this[n.DomainEventTypeName[e.type]];t&&t.bind(this)(e)}applyAndStage(e){this.apply(e),this._uncommittedEvents.push(e)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(5);t.TodoActionsPanelBtnGroup=s.default(class extends n.PureComponent{constructor(){super(...arguments),this.handleClickOutside=(()=>{this.props.showDefaultPanel()})}render(){return n.createElement("div",{className:"todo-list-todo-btn-group"},n.createElement("div",{className:"btn-group",role:"group"},this.props.children))}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoDeleteBtn=class extends n.PureComponent{render(){return n.createElement("button",{onClick:this.props.deleteTodo,type:"button",className:"btn btn-link","aria-label":"Delete"},n.createElement("span",{className:"glyphicon glyphicon-trash","aria-hidden":"true"}))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoRenameBtn=class extends n.PureComponent{render(){return n.createElement("button",{onClick:this.props.showRenamePanel,type:"button",className:"btn btn-link","aria-label":"Rename"},n.createElement("span",{className:"glyphicon glyphicon-pencil","aria-hidden":"true"}))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoPanelBtnGroup=class extends n.PureComponent{render(){return n.createElement("div",{className:"todo-list-todo-btn-group"},n.createElement("button",{onClick:this.props.showActionsPanel,type:"button",className:"btn btn-link","aria-label":"Actions"},n.createElement("span",{className:"glyphicon glyphicon-cog","aria-hidden":"true"})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(5);t.TodoRenameForm=s.default(class extends n.PureComponent{constructor(e){super(e),this.handleClickOutside=(()=>{this.props.showDefaultPanel()}),this.onChange=(e=>{this.setState({value:e.target.value})}),this.onSubmit=(e=>{e.preventDefault(),this.props.renameTodo(this.state.value),this.props.showDefaultPanel()}),this.state={value:this.props.todo.name}}render(){let e="todoRenameInput-"+this.props.todo.id;return n.createElement("form",{role:"form",onSubmit:this.onSubmit},n.createElement("label",{htmlFor:e,className:"sr-only"},"New Name"),n.createElement("div",{className:"input-group"},n.createElement("input",{id:e,name:"name",type:"text",className:"form-control",onChange:this.onChange,value:this.state.value,required:!0,maxLength:200}),n.createElement("span",{className:"input-group-btn"},n.createElement("button",{type:"submit",className:"btn btn-success","aria-label":"Rename To-do"},n.createElement("span",{className:"glyphicon glyphicon-pencil","aria-hidden":"true"})))))}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.AlertLoginLink=class extends n.PureComponent{constructor(){super(...arguments),this.loginClicked=(()=>{this.props.login(!1)})}render(){return n.createElement("a",{role:"button",tabIndex:0,onClick:this.loginClicked},"Sign in with Google")}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(1),i=o(2),r=o(19);o(54),i.initializeApp({apiKey:"AIzaSyA39ayMBQy61hI_F12NIVUnjBMnOxeh4NM",authDomain:"muchdone-daff6.firebaseapp.com",databaseURL:"https://muchdone-daff6.firebaseio.com",projectId:"muchdone-daff6",storageBucket:"muchdone-daff6.appspot.com",messagingSenderId:"1050428102724"}),s.render(n.createElement(r.App,null),document.getElementById("app"))},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(s,i){function r(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?s(e.value):new o(function(t){t(e.value)}).then(r,a)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=o(0),i=o(2),r=o(4),a=o(22),d=o(23),l=o(10),c=o(24),u=o(50),p=o(51),h=o(52);t.App=class extends s.PureComponent{constructor(e){super(e),this.offAuthStateChanged=null,this.offTodoListUpdated=null,this.offTodoListsUpdated=null,this.subscribeToTodoListUpdates=(e=>{this.offTodoListsUpdated=this.data.onTodoListsUpdated(t=>{let o=new u.TodoLists(t).ids[0];this.state.todoListId?this.state.todoListId&&!o?(this.offTodoListUpdated&&this.offTodoListUpdated(),this.setState({todoListId:null,todoListEvents:[]})):this.state.todoListId&&o&&this.state.todoListId!==o&&(this.offTodoListUpdated&&this.offTodoListUpdated(),this.setState({todoListId:o}),this.offTodoListUpdated=this.data.onTodoListUpdated(o,e=>this.setState({todoListEvents:e}))):o?(this.setState({todoListId:o}),e&&e(o),this.offTodoListUpdated=this.data.onTodoListUpdated(o,e=>this.setState({todoListEvents:e}))):e&&e(null)})}),this.login=(e=>{let t=e?i.auth.Auth.Persistence.LOCAL:i.auth.Auth.Persistence.SESSION;i.auth().setPersistence(t).then(()=>{i.auth().signInWithRedirect(new i.auth.GoogleAuthProvider)}).catch(console.log)}),this.logout=(()=>{i.auth().signOut().catch(console.log)}),this.commandDomainTodoList=(e=>n(this,void 0,void 0,function*(){let t=new l.TodoList(this.state.todoListEvents);e(t),t.uncommittedEvents.length&&(yield this.data.addUncommittedEvents(t.uncommittedEvents),!this.state.todoListId&&t.id&&(this.setState({todoListId:t.id}),this.offTodoListUpdated=this.data.onTodoListUpdated(t.id,e=>this.setState({todoListEvents:e}))))})),this.addTodo=(e=>{this.commandDomainTodoList(t=>{t.add(r.v4(),e)}).catch(console.log)}),this.completeTodo=(e=>{this.commandDomainTodoList(t=>{t.complete(e,Date.now())}).catch(console.log)}),this.uncompleteTodo=(e=>{this.commandDomainTodoList(t=>{t.uncomplete(e)}).catch(console.log)}),this.deleteTodo=(e=>{this.commandDomainTodoList(t=>{t.remove(e)}).catch(console.log)}),this.moveTodoUp=(e=>{this.commandDomainTodoList(t=>{t.changePosition(e,-1)}).catch(console.log)}),this.moveTodoDown=(e=>{this.commandDomainTodoList(t=>{t.changePosition(e,1)}).catch(console.log)}),this.renameTodo=((e,t)=>{this.commandDomainTodoList(o=>{o.rename(e,t)}).catch(console.log)}),this.state={todoListId:null,todoListEvents:[],isAuthenticated:!1,authStateWasReceived:!1,indexedDBSupported:"indexedDB"in window}}componentDidMount(){this.offAuthStateChanged=i.auth().onAuthStateChanged(e=>{console.log("onAuthStateChanged"),console.log(e),this.offTodoListUpdated&&this.offTodoListUpdated(),this.offTodoListsUpdated&&this.offTodoListsUpdated(),e?(this.setState({authStateWasReceived:!0,isAuthenticated:!0,todoListId:null,todoListEvents:[]}),this.data=new a.Data(new p.FirebaseRTDBEventStore),this.subscribeToTodoListUpdates(e=>{this.state.indexedDBSupported&&(this.offTodoListsUpdated&&this.offTodoListsUpdated(),this.data.importTodoList(new h.IndexedDBEventStore("much-done","event"),e).then(()=>{this.subscribeToTodoListUpdates()}).catch(console.log))}),d.updateUserProfile().catch(console.log)):(this.setState({authStateWasReceived:!0,isAuthenticated:!1,todoListId:null,todoListEvents:[]}),this.state.indexedDBSupported&&(this.data=new a.Data(new h.IndexedDBEventStore("much-done","event")),this.subscribeToTodoListUpdates()))})}componentWillUnmount(){this.offAuthStateChanged&&this.offAuthStateChanged(),this.offTodoListUpdated&&this.offTodoListUpdated(),this.offTodoListsUpdated&&this.offTodoListsUpdated()}render(){return s.createElement(c.Body,{events:this.state.todoListEvents,authStateWasReceived:this.state.authStateWasReceived,isAuthenticated:this.state.isAuthenticated,indexedDBSupported:this.state.indexedDBSupported,login:this.login,logout:this.logout,addTodo:this.addTodo,completeTodo:this.completeTodo,uncompleteTodo:this.uncompleteTodo,deleteTodo:this.deleteTodo,moveTodoUp:this.moveTodoUp,moveTodoDown:this.moveTodoDown,renameTodo:this.renameTodo})}}},function(e,t,o){var n,s,i=o(8),r=o(9),a=0,d=0;e.exports=function(e,t,o){var l=t&&o||0,c=t||[],u=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:s;if(null==u||null==p){var h=i();null==u&&(u=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=s=16383&(h[6]<<8|h[7]))}var m=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:d+1,v=m-a+(f-d)/1e4;if(v<0&&void 0===e.clockseq&&(p=p+1&16383),(v<0||m>a)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=m,d=f,s=p;var g=(1e4*(268435455&(m+=122192928e5))+f)%4294967296;c[l++]=g>>>24&255,c[l++]=g>>>16&255,c[l++]=g>>>8&255,c[l++]=255&g;var T=m/4294967296*1e4&268435455;c[l++]=T>>>8&255,c[l++]=255&T,c[l++]=T>>>24&15|16,c[l++]=T>>>16&255,c[l++]=p>>>8|128,c[l++]=255&p;for(var y=0;y<6;++y)c[l+y]=u[y];return t||r(c)}},function(e,t,o){var n=o(8),s=o(9);e.exports=function(e,t,o){var i=t&&o||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var a=0;a<16;++a)t[i+a]=r[a];return t||s(r)}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(s,i){function r(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?s(e.value):new o(function(t){t(e.value)}).then(r,a)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=o(3);t.Data=class{constructor(e){this.eventStore=e}onTodoListUpdated(e,t){return this.eventStore.onEventsByAggregateUpdated(e,t)}onTodoListsUpdated(e){return this.eventStore.onEventsByTypeUpdated(s.DomainEventTypeName.TodoListCreated,e)}addUncommittedEvents(e){return n(this,void 0,void 0,function*(){return this.eventStore.addUncommittedEvents(e)})}importTodoList(e,t){return n(this,void 0,void 0,function*(){let o=yield e.getAllEvents();if(!o.length)return;let n=t?o.filter(e=>e.type!==s.DomainEventTypeName.TodoListCreated).map(e=>Object.assign(e,{aggregateId:t})):o;return yield this.eventStore.addEvents(n),e.deleteEvents()})}}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(s,i){function r(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?s(e.value):new o(function(t){t(e.value)}).then(r,a)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=o(2);t.updateUserProfile=function(){return n(this,void 0,void 0,function*(){let e=s.auth().currentUser;if(!e)throw new Error("updateUserProfile(). User not logged into Firebase.");let t=e.providerData[0];if(!t)throw new Error("updateUserProfile(). No providerData.");let o={};return o[t.providerId.replace(/\./g,",")]={email:e.email,emailVerified:e.emailVerified},s.database().ref(`/users/${e.uid}/profile`).update(o)})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(10),i=o(25),r=o(27),a=o(28),d=o(33),l=o(47),c=o(48),u=o(49);t.Body=class extends n.PureComponent{constructor(e){super(e),this.showHistoryVersion=(e=>{this.setState({history:!0,historyVersion:e})}),this.showCurrentVersion=(()=>{this.setState({history:!1,historyVersion:0})}),this.hideLocalModeAlert=(()=>this.setState({showLocalModeAlert:!1})),this.state={history:!1,historyVersion:0,showLocalModeAlert:!0}}render(){let e=new s.TodoList(this.state.history?this.props.events.filter(e=>e.version<=this.state.historyVersion):this.props.events);return n.createElement(n.Fragment,null,n.createElement("div",{className:"navbar navbar-default navbar-static-top"},n.createElement("div",{className:"container"},n.createElement("div",{className:"navbar-header"},n.createElement("span",{className:"navbar-brand"},n.createElement("span",{className:"glyphicon glyphicon-check","aria-hidden":"true"})," MuchDone ")),n.createElement("span",{className:"navbar-text"},"It's a to-do list app."),this.props.authStateWasReceived?n.createElement(l.NavLoginBtn,{isAuthenticated:this.props.isAuthenticated,login:this.props.login,logout:this.props.logout}):null)),n.createElement("div",{className:"container"},this.props.authStateWasReceived?this.props.indexedDBSupported?n.createElement(n.Fragment,null,!this.props.isAuthenticated&&this.state.showLocalModeAlert?n.createElement(u.LocalModeAlert,{login:this.props.login,hide:this.hideLocalModeAlert}):null,n.createElement("div",{className:"row"},n.createElement("div",{className:"col-sm-8"},this.state.history?n.createElement(a.HistoryTodoListPanel,{todos:e.todos,completedTodos:e.completedTodos}):n.createElement(d.TodoListPanel,{todos:e.todos,completedTodos:e.completedTodos,addTodo:this.props.addTodo,completeTodo:this.props.completeTodo,uncompleteTodo:this.props.uncompleteTodo,deleteTodo:this.props.deleteTodo,moveTodoUp:this.props.moveTodoUp,moveTodoDown:this.props.moveTodoDown,renameTodo:this.props.renameTodo})),n.createElement("div",{className:"col-sm-4"},n.createElement("h4",null,"Domain Events"),this.props.events.length?n.createElement(i.EventList,{disableOnClickOutside:!this.state.history,events:this.props.events,showHistoryVersion:this.showHistoryVersion,showCurrentVersion:this.showCurrentVersion}):n.createElement(r.EventListEmpty,null)))):n.createElement(c.NoIndexedDBAlert,{login:this.props.login}):null,n.createElement("footer",null,n.createElement("p",null,"© 2018 - Jon Brian Skog"))))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(5),i=o(26);class r extends n.PureComponent{constructor(){super(...arguments),this.handleClickOutside=(()=>{this.props.showCurrentVersion()})}render(){return n.createElement("div",{className:"list-group"},this.props.events.map(e=>n.createElement(i.EventListItem,{key:e.id,event:e,showHistoryVersion:this.props.showHistoryVersion})))}}t.EventListInner=r,t.EventList=s.default(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(3);t.EventListItem=class extends n.PureComponent{constructor(){super(...arguments),this.showHistory=(e=>{this.props.showHistoryVersion(this.props.event.version)})}render(){return n.createElement("button",{onClick:this.showHistory,className:"list-group-item event-list-item"},this.props.event.version," : ",s.DomainEventTypeName[this.props.event.type])}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.EventListEmpty=(()=>n.createElement("p",null,n.createElement("span",{className:"glyphicon glyphicon-exclamation-sign","aria-hidden":"true"})," Add some to-dos to see events"))},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(29),i=o(31);t.HistoryTodoListPanel=class extends n.PureComponent{render(){return n.createElement("div",null,n.createElement("h3",{className:"sr-only"},"To-dos"),n.createElement(i.HistoryTodoList,{todos:this.props.todos}),this.props.completedTodos.length?n.createElement("div",null,n.createElement("h3",{className:"sr-only"},"Completed To-dos"),n.createElement(s.HistoryCompletedTodoList,{todos:this.props.completedTodos})):null)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(30);t.HistoryCompletedTodoList=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group"},this.props.todos.map(e=>n.createElement(s.HistoryCompletedTodoListItem,{key:e.id,todo:e})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(6);t.HistoryCompletedTodoListItem=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group-item list-group-item-success"},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(s.CompletedTodoTitle,{title:this.props.todo.name,completionDate:new Date(this.props.todo.completionTimestamp)})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(32);t.HistoryTodoList=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group"},this.props.todos.map(e=>n.createElement(s.HistoryTodoListItem,{key:e.id,todo:e})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(7);t.HistoryTodoListItem=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group-item"},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(s.TodoTitle,{title:this.props.todo.name})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(34),i=o(39),r=o(40);t.TodoListPanel=class extends n.PureComponent{render(){return n.createElement("div",null,n.createElement(i.TodoAddForm,{addTodo:this.props.addTodo}),n.createElement("br",null),n.createElement("h3",{className:"sr-only"},"To-dos"),n.createElement(r.TodoList,{todos:this.props.todos,completeTodo:this.props.completeTodo,deleteTodo:this.props.deleteTodo,moveTodoUp:this.props.moveTodoUp,moveTodoDown:this.props.moveTodoDown,renameTodo:this.props.renameTodo}),this.props.completedTodos.length?n.createElement("div",null,n.createElement("h3",{className:"sr-only"},"Completed To-dos"),n.createElement(s.CompletedTodoList,{todos:this.props.completedTodos,uncompleteTodo:this.props.uncompleteTodo,deleteTodo:this.props.deleteTodo,renameTodo:this.props.renameTodo})):null)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(35);t.CompletedTodoList=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group"},this.props.todos.map(e=>n.createElement(s.CompletedTodoListItem,{key:e.id,todo:e,uncompleteTodo:this.props.uncompleteTodo,deleteTodo:this.props.deleteTodo,renameTodo:this.props.renameTodo})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(36),i=o(37),r=o(38);var a;!function(e){e[e.DefaultPanel=0]="DefaultPanel",e[e.ActionsPanel=1]="ActionsPanel",e[e.RenamePanel=2]="RenamePanel"}(a||(a={}));t.CompletedTodoListItem=class extends n.PureComponent{constructor(e){super(e),this.uncompleteTodo=(()=>{this.props.uncompleteTodo(this.props.todo.id)}),this.deleteTodo=(()=>{this.props.deleteTodo(this.props.todo.id)}),this.renameTodo=(e=>{this.props.renameTodo(this.props.todo.id,e)}),this.showDefaultPanel=(()=>{this.setState({panel:a.DefaultPanel})}),this.showActionsPanel=(()=>{this.setState({panel:a.ActionsPanel})}),this.showRenamePanel=(()=>{this.setState({panel:a.RenamePanel})}),this.state={panel:a.DefaultPanel}}render(){let e;switch(this.state.panel){case a.DefaultPanel:e=n.createElement(i.CompletedTodoPanel,{todo:this.props.todo,uncompleteTodo:this.uncompleteTodo,showActionsPanel:this.showActionsPanel});break;case a.ActionsPanel:e=n.createElement(s.CompletedTodoActionsPanel,{todo:this.props.todo,deleteTodo:this.deleteTodo,showDefaultPanel:this.showDefaultPanel,showRenamePanel:this.showRenamePanel});break;case a.RenamePanel:e=n.createElement(r.CompletedTodoRenamePanel,{todo:this.props.todo,renameTodo:this.renameTodo,showDefaultPanel:this.showDefaultPanel});break;default:e=null}return e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(6),i=o(12),r=o(13),a=o(14);t.CompletedTodoActionsPanel=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group-item list-group-item-success"},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(s.CompletedTodoTitle,{title:this.props.todo.name,completionDate:new Date(this.props.todo.completionTimestamp)}),n.createElement(i.TodoActionsPanelBtnGroup,{showDefaultPanel:this.props.showDefaultPanel},n.createElement(r.TodoDeleteBtn,{deleteTodo:this.props.deleteTodo}),n.createElement(a.TodoRenameBtn,{showRenamePanel:this.props.showRenamePanel}))))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(1),i=o(6),r=o(15);t.CompletedTodoPanel=class extends n.PureComponent{constructor(){super(...arguments),this.btnGroupRef=(e=>{e&&(this.btnGroup=s.findDOMNode(e))}),this.onClick=(e=>{this.btnGroup.contains(e.target)||this.props.uncompleteTodo()})}render(){return n.createElement("a",{role:"button",tabIndex:0,onClick:this.onClick,className:"list-group-item list-group-item-success"},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(i.CompletedTodoTitle,{title:this.props.todo.name,completionDate:new Date(this.props.todo.completionTimestamp)}),n.createElement(r.TodoPanelBtnGroup,{ref:this.btnGroupRef,showActionsPanel:this.props.showActionsPanel})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(16);t.CompletedTodoRenamePanel=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group-item list-group-item-success"},n.createElement(s.TodoRenameForm,Object.assign({},this.props)))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoAddForm=class extends n.PureComponent{constructor(e){super(e),this.reset=(()=>{this.setState({value:""})}),this.onChange=(e=>{this.setState({value:e.target.value})}),this.onSubmit=(e=>{e.preventDefault(),this.props.addTodo(this.state.value),this.reset()}),this.state={value:""}}render(){return n.createElement("form",{role:"form",onSubmit:this.onSubmit},n.createElement("label",{htmlFor:"todoAddInput",className:"sr-only"},"New To-do Name"),n.createElement("div",{className:"input-group"},n.createElement("input",{id:"todoAddInput",name:"name",type:"text",className:"form-control",placeholder:"What do you need to do?",onChange:this.onChange,value:this.state.value,required:!0,maxLength:200}),n.createElement("span",{className:"input-group-btn"},n.createElement("button",{type:"submit",className:"btn btn-success","aria-label":"Add To-do"},n.createElement("span",{className:"glyphicon glyphicon-plus","aria-hidden":"true"})))))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(41);t.TodoList=class extends n.PureComponent{constructor(){super(...arguments),this.moveTodoUp=((e,t)=>{this.setMovedTodoRef(t),this.props.moveTodoUp(e)}),this.moveTodoDown=((e,t)=>{this.setMovedTodoRef(t),this.props.moveTodoDown(e)}),this.setMovedTodoRef=(e=>{this.movedTodoListItemOffsetTop=e.current.offsetTop,this.movedTodoListItemRef=e})}componentDidUpdate(){this.movedTodoListItemRef&&(window.scrollBy({top:this.movedTodoListItemRef.current.offsetTop-this.movedTodoListItemOffsetTop,behavior:"instant"}),this.movedTodoListItemRef=null)}render(){return n.createElement("div",{className:"list-group"},this.props.todos.map(e=>n.createElement(s.TodoListItem,{key:e.id,todo:e,completeTodo:this.props.completeTodo,deleteTodo:this.props.deleteTodo,moveTodoUp:this.moveTodoUp,moveTodoDown:this.moveTodoDown,renameTodo:this.props.renameTodo})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(42),i=o(45),r=o(46);var a;!function(e){e[e.DefaultPanel=0]="DefaultPanel",e[e.ActionsPanel=1]="ActionsPanel",e[e.RenamePanel=2]="RenamePanel"}(a||(a={}));t.TodoListItem=class extends n.PureComponent{constructor(e){super(e),this.completeTodo=(()=>{this.props.completeTodo(this.props.todo.id)}),this.deleteTodo=(()=>{this.props.deleteTodo(this.props.todo.id)}),this.moveTodoUp=(e=>{this.props.moveTodoUp(this.props.todo.id,e)}),this.moveTodoDown=(e=>{this.props.moveTodoDown(this.props.todo.id,e)}),this.renameTodo=(e=>{this.props.renameTodo(this.props.todo.id,e)}),this.showDefaultPanel=(()=>{this.setState({panel:a.DefaultPanel})}),this.showActionsPanel=(()=>{this.setState({panel:a.ActionsPanel})}),this.showRenamePanel=(()=>{this.setState({panel:a.RenamePanel})}),this.state={panel:a.DefaultPanel}}render(){let e;switch(this.state.panel){case a.DefaultPanel:e=n.createElement(i.TodoPanel,{todo:this.props.todo,completeTodo:this.completeTodo,showActionsPanel:this.showActionsPanel});break;case a.ActionsPanel:e=n.createElement(s.TodoActionsPanel,{todo:this.props.todo,deleteTodo:this.deleteTodo,moveTodoUp:this.moveTodoUp,moveTodoDown:this.moveTodoDown,showDefaultPanel:this.showDefaultPanel,showRenamePanel:this.showRenamePanel});break;case a.RenamePanel:e=n.createElement(r.TodoRenamePanel,{todo:this.props.todo,renameTodo:this.renameTodo,showDefaultPanel:this.showDefaultPanel});break;default:e=null}return e}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(12),i=o(13),r=o(43),a=o(44),d=o(14),l=o(7);t.TodoActionsPanel=class extends n.PureComponent{constructor(e){super(e),this.moveTodoUp=(()=>{this.props.moveTodoUp(this.listItemRef)}),this.moveTodoDown=(()=>{this.props.moveTodoDown(this.listItemRef)}),this.listItemRef=n.createRef()}render(){return n.createElement("div",{className:"list-group-item",ref:this.listItemRef},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(l.TodoTitle,{title:this.props.todo.name}),n.createElement(s.TodoActionsPanelBtnGroup,{showDefaultPanel:this.props.showDefaultPanel},n.createElement(i.TodoDeleteBtn,{deleteTodo:this.props.deleteTodo}),n.createElement(a.TodoMoveUpBtn,{moveTodoUp:this.moveTodoUp}),n.createElement(r.TodoMoveDownBtn,{moveTodoDown:this.moveTodoDown}),n.createElement(d.TodoRenameBtn,{showRenamePanel:this.props.showRenamePanel}))))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoMoveDownBtn=class extends n.PureComponent{render(){return n.createElement("button",{onClick:this.props.moveTodoDown,type:"button",className:"btn btn-link","aria-label":"Move down"},n.createElement("span",{className:"glyphicon glyphicon-chevron-down","aria-hidden":"true"}))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.TodoMoveUpBtn=class extends n.PureComponent{render(){return n.createElement("button",{onClick:this.props.moveTodoUp,type:"button",className:"btn btn-link","aria-label":"Move up"},n.createElement("span",{className:"glyphicon glyphicon-chevron-up","aria-hidden":"true"}))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(1),i=o(15),r=o(7);t.TodoPanel=class extends n.PureComponent{constructor(){super(...arguments),this.btnGroupRef=(e=>{e&&(this.btnGroup=s.findDOMNode(e))}),this.onClick=(e=>{this.btnGroup.contains(e.target)||this.props.completeTodo()})}render(){return n.createElement("a",{role:"button",tabIndex:0,onClick:this.onClick,className:"list-group-item"},n.createElement("div",{className:"todo-list-todo-panel"},n.createElement(r.TodoTitle,{title:this.props.todo.name}),n.createElement(i.TodoPanelBtnGroup,{ref:this.btnGroupRef,showActionsPanel:this.props.showActionsPanel})))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(16);t.TodoRenamePanel=class extends n.PureComponent{render(){return n.createElement("div",{className:"list-group-item"},n.createElement(s.TodoRenameForm,Object.assign({},this.props)))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0);t.NavLoginBtn=class extends n.PureComponent{constructor(e){super(e),this.loginClicked=(()=>{this.props.login(this.state.rememberMe)}),this.rememberMeChanged=(e=>{this.setState({rememberMe:e.target.checked})}),this.state={rememberMe:!1}}render(){return n.createElement("div",{className:"navbar-right"},this.props.isAuthenticated?n.createElement("button",{onClick:this.props.logout,type:"button",className:"btn btn-link navbar-btn"},"Sign out"):n.createElement(n.Fragment,null,n.createElement("label",{className:"checkbox-inline navbar-text"},n.createElement("input",{type:"checkbox",checked:this.state.rememberMe,onChange:this.rememberMeChanged}),"Remember me"),n.createElement("button",{onClick:this.loginClicked,type:"button",className:"btn btn-success navbar-btn"},"Sign in with Google")))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(17);t.NoIndexedDBAlert=class extends n.PureComponent{render(){return n.createElement(n.Fragment,null,n.createElement("div",{className:"alert alert-warning no-indexeddb-alert",role:"alert"},n.createElement("span",{className:"glyphicon glyphicon-exclamation-sign","aria-hidden":"true"}),n.createElement("span",null,"Your browser doesn't support storing your to-dos locally.")),n.createElement("p",null,"You have two options:"),n.createElement("ol",null,n.createElement("li",null,n.createElement("a",{href:"https://www.google.com/chrome/",target:"_blank"},"Get a better browser")),n.createElement("li",null,n.createElement(s.AlertLoginLink,{login:this.props.login})," to store your todos in the cloud ...which would be a lot cooler.")),n.createElement("p",null,"You should ",n.createElement("strong",null,"really")," do both those things."))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(0),s=o(17);t.LocalModeAlert=class extends n.PureComponent{render(){return n.createElement("div",{className:"alert alert-warning alert-dismissible",role:"alert"},n.createElement("button",{type:"button",className:"close",onClick:this.props.hide,"aria-label":"Close"},n.createElement("span",{"aria-hidden":"true"},"×")),n.createElement("strong",null,"You're not signed-in.")," Any to-dos you add will be stored locally; in the browser. This to-do list will only be accessible in this browser, on this device, and may be lost if your browsing data is cleared. ",n.createElement(s.AlertLoginLink,{login:this.props.login})," to store your to-dos in the cloud: they'll be available and synced in real-time on all your devices.")}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=o(11);t.TodoLists=class extends n.AggregateRoot{get ids(){return this._ids}init(){super.init(),this._ids=[]}TodoListCreated(e){this._ids.push(e.aggregateId)}}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(s,i){function r(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?s(e.value):new o(function(t){t(e.value)}).then(r,a)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=o(2);t.FirebaseRTDBEventStore=class{getEvents(e,t){return n(this,void 0,void 0,function*(){let o=s.auth().currentUser;if(!o)throw new Error("getEvents(). User not logged into Firebase.");let n=[],i=s.database().ref(`/users/${o.uid}/${e}`).orderByChild("version");return t&&(i=i.endAt(t)),(yield i.once("value")).forEach(e=>{n.push(e.val())}),n})}getAllEvents(e){return n(this,void 0,void 0,function*(){return yield this.getEvents("events",e)})}getEventsByAggregate(e,t){return n(this,void 0,void 0,function*(){return yield this.getEvents(`eventsByAggregate/${e}`,t)})}getEventsByType(e,t){return n(this,void 0,void 0,function*(){return yield this.getEvents(`eventsByType/${e}`,t)})}onEventsUpdated(e,t){let o=s.auth().currentUser;if(!o)throw new Error("onEventsUpdated(). User not logged into Firebase.");let n=s.database().ref(`/users/${o.uid}/${e}`),i=n.on("value",e=>{let o=[];e&&e.forEach(e=>{o.push(e.val())}),t(o,r)}),r=()=>{n.off("value",i)};return r}onEventsByAggregateUpdated(e,t){return this.onEventsUpdated(`eventsByAggregate/${e}`,t)}onEventsByTypeUpdated(e,t){return this.onEventsUpdated(`eventsByType/${e}`,t)}addEvents(e){return n(this,void 0,void 0,function*(){let t=s.auth().currentUser;if(!t)throw new Error("addEvents(). User not logged into Firebase.");let o=s.database().ref(`/users/${t.uid}`),n={};for(const t of e){let e=o.child("/events").push().key;n[`/events/${e}`]=t,n[`/eventsByAggregate/${t.aggregateId}/${e}`]=t,n[`/eventsByType/${t.type}/${e}`]=t}return o.update(n)})}addUncommittedEvents(e){return n(this,void 0,void 0,function*(){return this.addEvents(e.map(e=>Object.assign({version:s.database.ServerValue.TIMESTAMP},e)))})}}},function(e,t,o){"use strict";var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(s,i){function r(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?s(e.value):new o(function(t){t(e.value)}).then(r,a)}d((n=n.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=o(53),i="id",r="version";t.IndexedDBEventStore=class{constructor(e,t){this.dbName=e,this.storeName=t,this._subs=new Map}open(){return n(this,void 0,void 0,function*(){return yield s.default.open(this.dbName,1,e=>{switch(e.oldVersion){case 0:e.createObjectStore(this.storeName,{keyPath:i}).createIndex(r,r,{unique:!1})}})})}getAllEvents(e){return n(this,void 0,void 0,function*(){let t=(yield this.open()).transaction(this.storeName).objectStore(this.storeName).index(r);return e?t.getAll(IDBKeyRange.upperBound(e)):t.getAll()})}getEventsBy(e,t){return n(this,void 0,void 0,function*(){let o=[],n=(yield this.open()).transaction(this.storeName),s=n.objectStore(this.storeName).index(r),i=t?IDBKeyRange.upperBound(t):null;return s.iterateCursor(i,function(t){if(!t)return;let n=t.value;e(n)&&o.push(n),t.continue()}),yield n.complete,o})}getEventsByAggregate(e,t){return n(this,void 0,void 0,function*(){return this.getEventsBy(t=>t.aggregateId===e,t)})}getEventsByType(e,t){return n(this,void 0,void 0,function*(){return this.getEventsBy(t=>t.type===e,t)})}onEventsByUpdated(e,t,o){let n=Symbol(),s=()=>this._subs.delete(n),i=()=>t().then(e=>o(e,s));return this._subs.set(n,{predicate:e,action:i}),i().catch(console.log),s}onEventsByAggregateUpdated(e,t){return this.onEventsByUpdated(t=>t.aggregateId===e,()=>this.getEventsByAggregate(e),t)}onEventsByTypeUpdated(e,t){return this.onEventsByUpdated(t=>t.type===e,()=>this.getEventsByType(e),t)}triggerSubs(e){return n(this,void 0,void 0,function*(){let t=[];for(const o of this._subs.values())for(const n of e)if(o.predicate(n)){t.push(o.action);break}yield Promise.all(t.map(e=>e()))})}addEvents(e){return n(this,void 0,void 0,function*(){let t=(yield this.open()).transaction(this.storeName,"readwrite"),o=t.objectStore(this.storeName),n=e.map(e=>o.add(e));return yield Promise.all(n),yield t.complete,this.triggerSubs(e)})}addUncommittedEvents(e){return n(this,void 0,void 0,function*(){return this.addEvents(e.map(e=>Object.assign({version:Date.now()},e)))})}deleteEvents(){return n(this,void 0,void 0,function*(){let e=(yield this.open()).transaction(this.storeName,"readwrite");return yield e.objectStore(this.storeName).clear(),e.complete})}}},function(e,t,o){"use strict";!function(){function t(e){return new Promise(function(t,o){e.onsuccess=function(){t(e.result)},e.onerror=function(){o(e.error)}})}function o(e,o,n){var s,i=new Promise(function(i,r){t(s=e[o].apply(e,n)).then(i,r)});return i.request=s,i}function n(e,t,o){o.forEach(function(o){Object.defineProperty(e.prototype,o,{get:function(){return this[t][o]},set:function(e){this[t][o]=e}})})}function s(e,t,n,s){s.forEach(function(s){s in n.prototype&&(e.prototype[s]=function(){return o(this[t],s,arguments)})})}function i(e,t,o,n){n.forEach(function(n){n in o.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})})}function r(e,t,n,s){s.forEach(function(s){s in n.prototype&&(e.prototype[s]=function(){return function(e,t,n){var s=o(e,t,n);return s.then(function(e){if(e)return new d(e,s.request)})}(this[t],s,arguments)})})}function a(e){this._index=e}function d(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function c(e){this._tx=e,this.complete=new Promise(function(t,o){e.oncomplete=function(){t()},e.onerror=function(){o(e.error)},e.onabort=function(){o(e.error)}})}function u(e,t,o){this._db=e,this.oldVersion=t,this.transaction=new c(o)}function p(e){this._db=e}n(a,"_index",["name","keyPath","multiEntry","unique"]),s(a,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(a,"_index",IDBIndex,["openCursor","openKeyCursor"]),n(d,"_cursor",["direction","key","primaryKey","value"]),s(d,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(e){e in IDBCursor.prototype&&(d.prototype[e]=function(){var o=this,n=arguments;return Promise.resolve().then(function(){return o._cursor[e].apply(o._cursor,n),t(o._request).then(function(e){if(e)return new d(e,o._request)})})})}),l.prototype.createIndex=function(){return new a(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new a(this._store.index.apply(this._store,arguments))},n(l,"_store",["name","keyPath","indexNames","autoIncrement"]),s(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),i(l,"_store",IDBObjectStore,["deleteIndex"]),c.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},n(c,"_tx",["objectStoreNames","mode"]),i(c,"_tx",IDBTransaction,["abort"]),u.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},n(u,"_db",["name","version","objectStoreNames"]),i(u,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new c(this._db.transaction.apply(this._db,arguments))},n(p,"_db",["name","version","objectStoreNames"]),i(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(e){[l,a].forEach(function(t){e in t.prototype&&(t.prototype[e.replace("open","iterate")]=function(){var t=function(e){return Array.prototype.slice.call(e)}(arguments),o=t[t.length-1],n=this._store||this._index,s=n[e].apply(n,t.slice(0,-1));s.onsuccess=function(){o(s.result)}})})}),[a,l].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var o=this,n=[];return new Promise(function(s){o.iterateCursor(e,function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():s(n)):s(n)})})})});var h={open:function(e,t,n){var s=o(indexedDB,"open",[e,t]),i=s.request;return i&&(i.onupgradeneeded=function(e){n&&n(new u(i.result,e.oldVersion,i.transaction))}),s.then(function(e){return new p(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};e.exports=h,e.exports.default=e.exports}()},function(e,t,o){}]);
//# sourceMappingURL=scripts.c256810e5630e2b9a733.js.map