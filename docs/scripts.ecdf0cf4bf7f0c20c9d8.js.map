{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///external \"firebase\"","webpack:///./domain/events.ts","webpack:///../node_modules/uuid/index.js","webpack:///../node_modules/react-onclickoutside/dist/react-onclickoutside.es.js","webpack:///./components/todo-list-panel/completed-todo-list/completed-todo-list-item/completed-todo-panel/completed-todo-title.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-panel/todo-title.tsx","webpack:///../node_modules/uuid/lib/rng-browser.js","webpack:///../node_modules/uuid/lib/bytesToUuid.js","webpack:///./domain/todo-list.ts","webpack:///./domain/aggregate-root.ts","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-actions-panel-btn-group.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-delete-btn.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-rename-btn.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-panel/todo-panel-btn-group.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-rename-panel/todo-rename-form.tsx","webpack:///./components/alert-login-link.tsx","webpack:///./index.tsx","webpack:///./components/app.tsx","webpack:///../node_modules/uuid/v1.js","webpack:///../node_modules/uuid/v4.js","webpack:///./data.ts","webpack:///./data/firebase-rtdb.ts","webpack:///./components/body.tsx","webpack:///./components/event-list.tsx","webpack:///./components/event-list/event-list-item.tsx","webpack:///./components/event-list-empty.tsx","webpack:///./components/history-todo-list-panel.tsx","webpack:///./components/history-todo-list-panel/history-completed-todo-list.tsx","webpack:///./components/history-todo-list-panel/history-completed-todo-list/history-completed-todo-list-item.tsx","webpack:///./components/history-todo-list-panel/history-todo-list.tsx","webpack:///./components/history-todo-list-panel/history-todo-list/history-todo-list-item.tsx","webpack:///./components/todo-list-panel.tsx","webpack:///./components/todo-list-panel/completed-todo-list.tsx","webpack:///./components/todo-list-panel/completed-todo-list/completed-todo-list-item.tsx","webpack:///./components/todo-list-panel/completed-todo-list/completed-todo-list-item/completed-todo-actions-panel.tsx","webpack:///./components/todo-list-panel/completed-todo-list/completed-todo-list-item/completed-todo-panel.tsx","webpack:///./components/todo-list-panel/completed-todo-list/completed-todo-list-item/completed-todo-rename-panel.tsx","webpack:///./components/todo-list-panel/todo-add-form.tsx","webpack:///./components/todo-list-panel/todo-list.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-move-down-btn.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-move-up-btn.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-panel.tsx","webpack:///./components/todo-list-panel/todo-list/todo-list-item/todo-rename-panel.tsx","webpack:///./components/nav-login-btn.tsx","webpack:///./components/no-indexeddb-alert.tsx","webpack:///./components/local-mode-alert.tsx","webpack:///./domain/todo-lists.ts","webpack:///./data/firebase-rtdb-event-store.ts","webpack:///./data/indexeddb-event-store.ts","webpack:///../node_modules/idb/lib/idb.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","React","ReactDOM","firebase","uuid_1","DomainEventTypeName","DomainEventBase","[object Object]","this","id","v4","TodoListCreated","aggregateId","super","type","TodoAdded","todoId","todoName","TodoRemoved","TodoCompleted","todoCompletionTimestamp","TodoUncompleted","TodoRenamed","TodoPositionChanged","todoOffset","v1","uuid","__webpack_exports__","IGNORE_CLASS_NAME","react__WEBPACK_IMPORTED_MODULE_0__","react_dom__WEBPACK_IMPORTED_MODULE_1__","isNodeFound","current","componentNode","ignoreClass","correspondingElement","classList","contains","testPassiveEventSupport","window","addEventListener","passive","options","noop","removeEventListener","passiveEventSupport","uid","seed","autoInc","handlersMap","enabledInstances","touchEvents","getEventHandlerOptions","instance","eventName","handlerOptions","indexOf","props","preventDefault","WrappedComponent","config","_class","_temp","_Component","onClickOutside","_this","__outsideClickHandler","event","__clickOutsideHandlerProp","getInstance","handleClickOutside","Error","enableOnClickOutside","document","_uid","events","eventTypes","forEach","disableOnClickOutside","stopPropagation","excludeScrollbar","evt","documentElement","clientWidth","clientX","clientHeight","clientY","clickedScrollbar","parentNode","findHighest","target","outsideClickIgnoreClass","fn","getRef","ref","instanceRef","subClass","superClass","constructor","__proto__","_inheritsLoose","_proto","isReactComponent","componentDidMount","createElement","componentDidUpdate","componentWillUnmount","render","_props","source","excluded","sourceKeys","keys","length","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","_objectWithoutProperties","wrappedRef","displayName","defaultProps","getClass","CompletedTodoTitle","PureComponent","className","title","completionDate","toLocaleDateString","TodoTitle","getRandomValues","crypto","msCrypto","rnds8","Uint8Array","rnds","Array","Math","random","byteToHex","toString","substr","buf","offset","bth","join","aggregate_root_1","events_1","TodoList","AggregateRoot","todos","_todos","filter","x","isCompleted","completedTodos","sort","y","completionTimestamp","init","_todosMap","Map","e","_id","todo","push","set","findIndex","splice","delete","incompleteTodoPositions","reduce","from","to","arraySwap","arr","a","agId","applyAndStage","has","uncommittedEvents","_uncommittedEvents","apply","handler","react_onclickoutside_1","TodoActionsPanelBtnGroup","default","showDefaultPanel","role","children","TodoDeleteBtn","onClick","deleteTodo","aria-label","aria-hidden","TodoRenameBtn","showRenamePanel","TodoPanelBtnGroup","showActionsPanel","TodoRenameForm","onChange","setState","onSubmit","renameTodo","state","inputId","htmlFor","required","maxLength","AlertLoginLink","loginClicked","login","tabIndex","app_1","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","App","getElementById","data_1","firebase_rtdb_1","todo_list_1","body_1","todo_lists_1","firebase_rtdb_event_store_1","indexeddb_event_store_1","offAuthStateChanged","offTodoListUpdated","offTodoListsUpdated","subscribeToTodoListUpdates","onListIdLoaded","data","onTodoListsUpdated","lists","TodoLists","todoListId","ids","onTodoListUpdated","todoListEvents","rememberMe","persistence","auth","Auth","Persistence","LOCAL","SESSION","setPersistence","then","signInWithRedirect","GoogleAuthProvider","catch","console","log","logout","signOut","commandDomainTodoList","command","__awaiter","todoList","addUncommittedEvents","addTodo","list","add","completeTodo","complete","Date","now","uncompleteTodo","uncomplete","remove","moveTodoUp","changePosition","moveTodoDown","rename","isAuthenticated","authStateWasReceived","indexedDBSupported","onAuthStateChanged","user","Data","FirebaseRTDBEventStore","importTodoList","IndexedDBEventStore","updateUserProfile","Body","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","b","node","clockseq","undefined","seedBytes","msecs","getTime","nsecs","dt","tl","tmh","ii","eventStore","callback","onEventsByAggregateUpdated","onEventsByTypeUpdated","sourceStore","targetAgId","getAllEvents","importEvents","deleteEvents","currentUser","providerData","profile","providerId","replace","email","emailVerified","database","update","event_list_1","event_list_empty_1","history_todo_list_panel_1","todo_list_panel_1","nav_login_btn_1","no_indexeddb_alert_1","local_mode_alert_1","showHistoryVersion","version","history","historyVersion","showCurrentVersion","hideLocalModeAlert","showLocalModeAlert","Fragment","NavLoginBtn","LocalModeAlert","hide","HistoryTodoListPanel","TodoListPanel","EventList","EventListEmpty","NoIndexedDBAlert","event_list_item_1","EventListInner","map","EventListItem","showHistory","history_completed_todo_list_1","history_todo_list_1","HistoryTodoList","HistoryCompletedTodoList","history_completed_todo_list_item_1","HistoryCompletedTodoListItem","completed_todo_title_1","history_todo_list_item_1","HistoryTodoListItem","todo_title_1","completed_todo_list_1","todo_add_form_1","TodoAddForm","CompletedTodoList","completed_todo_list_item_1","CompletedTodoListItem","completed_todo_actions_panel_1","completed_todo_panel_1","completed_todo_rename_panel_1","PanelType","panel","DefaultPanel","ActionsPanel","RenamePanel","CompletedTodoPanel","CompletedTodoActionsPanel","CompletedTodoRenamePanel","todo_actions_panel_btn_group_1","todo_delete_btn_1","todo_rename_btn_1","react_dom_1","todo_panel_btn_group_1","btnGroupRef","comp","btnGroup","findDOMNode","todo_rename_form_1","assign","reset","placeholder","todo_list_item_1","listItemRef","setMovedTodoRef","movedTodoListItemOffsetTop","offsetTop","movedTodoListItemRef","scrollBy","top","behavior","TodoListItem","todo_actions_panel_1","todo_panel_1","todo_rename_panel_1","TodoPanel","TodoActionsPanel","TodoRenamePanel","todo_move_down_btn_1","todo_move_up_btn_1","createRef","TodoMoveUpBtn","TodoMoveDownBtn","rememberMeChanged","checked","alert_login_link_1","href","_ids","path","orderByChild","endAt","once","childSnap","val","getEvents","typeId","onCallback","on","snap","off","onEventsUpdated","updates","child","addEvents","ServerValue","TIMESTAMP","idb_1","eventIdPropName","versionPropName","dbName","storeName","_subs","open","db","oldVersion","createObjectStore","keyPath","createIndex","unique","index","transaction","objectStore","getAll","IDBKeyRange","upperBound","predicate","tx","range","iterateCursor","cursor","continue","getEventsBy","subResults","sym","unsub","action","onEventsByUpdated","getEventsByAggregate","getEventsByType","triggeredSubActions","sub","values","Promise","all","store","addPromises","triggerSubs","clear","promisifyRequest","request","resolve","reject","onsuccess","result","onerror","error","promisifyRequestCall","obj","method","args","proxyProperties","ProxyClass","targetProp","properties","prop","proxyRequestMethods","Constructor","arguments","proxyMethods","proxyCursorRequestMethods","Cursor","promisifyCursorRequestCall","Index","_index","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","slice","toArray","nativeObject","query","count","items","exp","upgradeCallback","indexedDB","onupgradeneeded"],"mappings":"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","file":"scripts.ecdf0cf4bf7f0c20c9d8.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 18);\n","module.exports = React;","module.exports = ReactDOM;","module.exports = firebase;","import { ESEvent, UncommittedESEvent } from \"data/event-store\";\r\nimport { TodoIdType } from \"./todo\";\r\nimport { v4 as uuid } from \"uuid\";\r\n\r\nexport enum DomainEventTypeName {\r\n  TodoListCreated,\r\n  TodoAdded,\r\n  TodoRemoved,\r\n  TodoCompleted,\r\n  TodoUncompleted,\r\n  TodoRenamed,\r\n  TodoPositionChanged,\r\n}\r\nexport type UncommittedDomainEvent = UncommittedESEvent<DomainEventTypeName>;\r\nexport type DomainEvent = ESEvent<DomainEventTypeName>;\r\n\r\nabstract class DomainEventBase {\r\n  readonly id = uuid();\r\n}\r\n\r\nexport class TodoListCreated extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoListCreated;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoAdded extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoAdded;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n    readonly todoName: string,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoRemoved extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoRemoved;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoCompleted extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoCompleted;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n    readonly todoCompletionTimestamp: number,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoUncompleted extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoUncompleted;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoRenamed extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoRenamed;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n    readonly todoName: string,\r\n  ) { super(); }\r\n}\r\n\r\nexport class TodoPositionChanged extends DomainEventBase implements UncommittedDomainEvent {\r\n  readonly type = DomainEventTypeName.TodoPositionChanged;\r\n  constructor(\r\n    readonly aggregateId: string,\r\n    readonly todoId: TodoIdType,\r\n    readonly todoOffset: number,\r\n  ) { super(); }\r\n}\r\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","import { Component, createElement } from 'react';\nimport { findDOMNode } from 'react-dom';\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\n/**\n * Check whether some DOM node is our Component's node.\n */\nfunction isNodeFound(current, componentNode, ignoreClass) {\n  if (current === componentNode) {\n    return true;\n  } // SVG <use/> elements do not technically reside in the rendered DOM, so\n  // they do not have classList directly, but they offer a link to their\n  // corresponding element, which can have classList. This extra check is for\n  // that case.\n  // See: http://www.w3.org/TR/SVG11/struct.html#InterfaceSVGUseElement\n  // Discussion: https://github.com/Pomax/react-onclickoutside/pull/17\n\n\n  if (current.correspondingElement) {\n    return current.correspondingElement.classList.contains(ignoreClass);\n  }\n\n  return current.classList.contains(ignoreClass);\n}\n/**\n * Try to find our node in a hierarchy of nodes, returning the document\n * node as highest node if our node is not found in the path up.\n */\n\nfunction findHighest(current, componentNode, ignoreClass) {\n  if (current === componentNode) {\n    return true;\n  } // If source=local then this event came from 'somewhere'\n  // inside and should be ignored. We could handle this with\n  // a layered approach, too, but that requires going back to\n  // thinking in terms of Dom node nesting, running counter\n  // to React's 'you shouldn't care about the DOM' philosophy.\n\n\n  while (current.parentNode) {\n    if (isNodeFound(current, componentNode, ignoreClass)) {\n      return true;\n    }\n\n    current = current.parentNode;\n  }\n\n  return current;\n}\n/**\n * Check if the browser scrollbar was clicked\n */\n\nfunction clickedScrollbar(evt) {\n  return document.documentElement.clientWidth <= evt.clientX || document.documentElement.clientHeight <= evt.clientY;\n}\n\n// ideally will get replaced with external dep\n// when rafrex/detect-passive-events#4 and rafrex/detect-passive-events#5 get merged in\nvar testPassiveEventSupport = function testPassiveEventSupport() {\n  if (typeof window === 'undefined' || typeof window.addEventListener !== 'function') {\n    return;\n  }\n\n  var passive = false;\n  var options = Object.defineProperty({}, 'passive', {\n    get: function get() {\n      passive = true;\n    }\n  });\n\n  var noop = function noop() {};\n\n  window.addEventListener('testPassiveEventSupport', noop, options);\n  window.removeEventListener('testPassiveEventSupport', noop, options);\n  return passive;\n};\n\nfunction autoInc(seed) {\n  if (seed === void 0) {\n    seed = 0;\n  }\n\n  return function () {\n    return ++seed;\n  };\n}\n\nvar uid = autoInc();\n\nvar passiveEventSupport;\nvar handlersMap = {};\nvar enabledInstances = {};\nvar touchEvents = ['touchstart', 'touchmove'];\nvar IGNORE_CLASS_NAME = 'ignore-react-onclickoutside';\n/**\n * Options for addEventHandler and removeEventHandler\n */\n\nfunction getEventHandlerOptions(instance, eventName) {\n  var handlerOptions = null;\n  var isTouchEvent = touchEvents.indexOf(eventName) !== -1;\n\n  if (isTouchEvent && passiveEventSupport) {\n    handlerOptions = {\n      passive: !instance.props.preventDefault\n    };\n  }\n\n  return handlerOptions;\n}\n/**\n * This function generates the HOC function that you'll use\n * in order to impart onOutsideClick listening to an\n * arbitrary component. It gets called at the end of the\n * bootstrapping code to yield an instance of the\n * onClickOutsideHOC function defined inside setupHOC().\n */\n\n\nfunction onClickOutsideHOC(WrappedComponent, config) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    _inheritsLoose(onClickOutside, _Component);\n\n    function onClickOutside(props) {\n      var _this;\n\n      _this = _Component.call(this, props) || this;\n\n      _this.__outsideClickHandler = function (event) {\n        if (typeof _this.__clickOutsideHandlerProp === 'function') {\n          _this.__clickOutsideHandlerProp(event);\n\n          return;\n        }\n\n        var instance = _this.getInstance();\n\n        if (typeof instance.props.handleClickOutside === 'function') {\n          instance.props.handleClickOutside(event);\n          return;\n        }\n\n        if (typeof instance.handleClickOutside === 'function') {\n          instance.handleClickOutside(event);\n          return;\n        }\n\n        throw new Error('WrappedComponent lacks a handleClickOutside(event) function for processing outside click events.');\n      };\n\n      _this.enableOnClickOutside = function () {\n        if (typeof document === 'undefined' || enabledInstances[_this._uid]) {\n          return;\n        }\n\n        if (typeof passiveEventSupport === 'undefined') {\n          passiveEventSupport = testPassiveEventSupport();\n        }\n\n        enabledInstances[_this._uid] = true;\n        var events = _this.props.eventTypes;\n\n        if (!events.forEach) {\n          events = [events];\n        }\n\n        handlersMap[_this._uid] = function (event) {\n          if (_this.props.disableOnClickOutside) return;\n          if (_this.componentNode === null) return;\n\n          if (_this.props.preventDefault) {\n            event.preventDefault();\n          }\n\n          if (_this.props.stopPropagation) {\n            event.stopPropagation();\n          }\n\n          if (_this.props.excludeScrollbar && clickedScrollbar(event)) return;\n          var current = event.target;\n\n          if (findHighest(current, _this.componentNode, _this.props.outsideClickIgnoreClass) !== document) {\n            return;\n          }\n\n          _this.__outsideClickHandler(event);\n        };\n\n        events.forEach(function (eventName) {\n          document.addEventListener(eventName, handlersMap[_this._uid], getEventHandlerOptions(_this, eventName));\n        });\n      };\n\n      _this.disableOnClickOutside = function () {\n        delete enabledInstances[_this._uid];\n        var fn = handlersMap[_this._uid];\n\n        if (fn && typeof document !== 'undefined') {\n          var events = _this.props.eventTypes;\n\n          if (!events.forEach) {\n            events = [events];\n          }\n\n          events.forEach(function (eventName) {\n            return document.removeEventListener(eventName, fn, getEventHandlerOptions(_this, eventName));\n          });\n          delete handlersMap[_this._uid];\n        }\n      };\n\n      _this.getRef = function (ref) {\n        return _this.instanceRef = ref;\n      };\n\n      _this._uid = uid();\n      return _this;\n    }\n    /**\n     * Access the WrappedComponent's instance.\n     */\n\n\n    var _proto = onClickOutside.prototype;\n\n    _proto.getInstance = function getInstance() {\n      if (!WrappedComponent.prototype.isReactComponent) {\n        return this;\n      }\n\n      var ref = this.instanceRef;\n      return ref.getInstance ? ref.getInstance() : ref;\n    };\n\n    /**\n     * Add click listeners to the current document,\n     * linked to this component's state.\n     */\n    _proto.componentDidMount = function componentDidMount() {\n      // If we are in an environment without a DOM such\n      // as shallow rendering or snapshots then we exit\n      // early to prevent any unhandled errors being thrown.\n      if (typeof document === 'undefined' || !document.createElement) {\n        return;\n      }\n\n      var instance = this.getInstance();\n\n      if (config && typeof config.handleClickOutside === 'function') {\n        this.__clickOutsideHandlerProp = config.handleClickOutside(instance);\n\n        if (typeof this.__clickOutsideHandlerProp !== 'function') {\n          throw new Error('WrappedComponent lacks a function for processing outside click events specified by the handleClickOutside config option.');\n        }\n      }\n\n      this.componentNode = findDOMNode(this.getInstance());\n      this.enableOnClickOutside();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate() {\n      this.componentNode = findDOMNode(this.getInstance());\n    };\n    /**\n     * Remove all document's event listeners for this component\n     */\n\n\n    _proto.componentWillUnmount = function componentWillUnmount() {\n      this.disableOnClickOutside();\n    };\n    /**\n     * Can be called to explicitly enable event listening\n     * for clicks and touches outside of this element.\n     */\n\n\n    /**\n     * Pass-through render\n     */\n    _proto.render = function render() {\n      // eslint-disable-next-line no-unused-vars\n      var _props = this.props,\n          excludeScrollbar = _props.excludeScrollbar,\n          props = _objectWithoutProperties(_props, [\"excludeScrollbar\"]);\n\n      if (WrappedComponent.prototype.isReactComponent) {\n        props.ref = this.getRef;\n      } else {\n        props.wrappedRef = this.getRef;\n      }\n\n      props.disableOnClickOutside = this.disableOnClickOutside;\n      props.enableOnClickOutside = this.enableOnClickOutside;\n      return createElement(WrappedComponent, props);\n    };\n\n    return onClickOutside;\n  }(Component), _class.displayName = \"OnClickOutside(\" + (WrappedComponent.displayName || WrappedComponent.name || 'Component') + \")\", _class.defaultProps = {\n    eventTypes: ['mousedown', 'touchstart'],\n    excludeScrollbar: config && config.excludeScrollbar || false,\n    outsideClickIgnoreClass: IGNORE_CLASS_NAME,\n    preventDefault: false,\n    stopPropagation: false\n  }, _class.getClass = function () {\n    return WrappedComponent.getClass ? WrappedComponent.getClass() : WrappedComponent;\n  }, _temp;\n}\n\nexport { IGNORE_CLASS_NAME };\nexport default onClickOutsideHOC;\n","import * as React from \"react\";\r\n\r\nexport interface CompletedTodoTitleProps {\r\n  title: string;\r\n  completionDate: Date;\r\n}\r\n\r\nexport class CompletedTodoTitle extends React.PureComponent<CompletedTodoTitleProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"todo-list-todo-title\">\r\n        {this.props.title}<br />\r\n        <small>Completed on {this.props.completionDate.toLocaleDateString()}</small>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoTitleProps {\r\n  title: string;\r\n}\r\n\r\nexport class TodoTitle extends React.PureComponent<TodoTitleProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"todo-list-todo-title\">{this.props.title}</div>\r\n    );\r\n  }\r\n}\r\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","import { v4 as uuid } from \"uuid\";\r\nimport { AggregateRoot } from \"./aggregate-root\";\r\nimport { TodoAdded, TodoCompleted, TodoPositionChanged, TodoRemoved, TodoRenamed, TodoUncompleted, TodoListCreated } from \"./events\";\r\nimport { CompletedTodo, Todo, TodoIdType } from \"./todo\";\r\n\r\nexport class TodoList extends AggregateRoot {\r\n  protected _todos!: (Todo | CompletedTodo)[];\r\n  protected _todosMap!: Map<TodoIdType, Todo | CompletedTodo>;\r\n  get todos(): Todo[] {\r\n    return this._todos.filter(x => !x.isCompleted);\r\n  }\r\n  get completedTodos(): CompletedTodo[] {\r\n    return (this._todos.filter(x => x.isCompleted) as CompletedTodo[])\r\n      .sort((x, y) => y.completionTimestamp - x.completionTimestamp);\r\n  }\r\n  protected init(): void {\r\n    super.init();\r\n    this._todos = [];\r\n    this._todosMap = new Map();\r\n  }\r\n\r\n  // Domain Event Handlers\r\n  protected TodoAdded(e: TodoAdded): void {\r\n    if (!this.id) {\r\n      this._id = e.aggregateId;\r\n    }\r\n    let todo: Todo = {\r\n      id: e.todoId,\r\n      name: e.todoName,\r\n      isCompleted: false,\r\n    };\r\n    this._todos.push(todo);\r\n    this._todosMap.set(e.todoId, todo);\r\n  }\r\n  protected TodoRemoved(e: TodoRemoved): void {\r\n    let i = this._todos.findIndex(x => x.id === e.todoId);\r\n    if (i !== -1) {\r\n      this._todos.splice(i, 1);\r\n      this._todosMap.delete(e.todoId);\r\n    }\r\n  }\r\n  protected TodoCompleted(e: TodoCompleted): void {\r\n    let todo = this._todosMap.get(e.todoId);\r\n    if (todo) {\r\n      todo.isCompleted = true;\r\n      (todo as CompletedTodo).completionTimestamp = e.todoCompletionTimestamp;\r\n    }\r\n  }\r\n  protected TodoUncompleted(e: TodoUncompleted): void {\r\n    let todo = this._todosMap.get(e.todoId);\r\n    if (todo) {\r\n      todo.isCompleted = false;\r\n    }\r\n  }\r\n  protected TodoRenamed(e: TodoRenamed): void {\r\n    let todo = this._todosMap.get(e.todoId);\r\n    if (todo) {\r\n      todo.name = e.todoName;\r\n    }\r\n  }\r\n  protected TodoPositionChanged(e: TodoPositionChanged): void {\r\n    let incompleteTodoPositions: number[] = this._todos.reduce<number[]>((p, c, i) => {\r\n      if (!c.isCompleted) {\r\n        p.push(i);\r\n      }\r\n      return p;\r\n    }, []);\r\n    let from = incompleteTodoPositions.findIndex(x => this._todos[x].id === e.todoId);\r\n    if (from === -1) {\r\n      return;\r\n    }\r\n    let to = from + e.todoOffset;\r\n    if (to < 0) {\r\n      to = 0;\r\n    } else if (to > incompleteTodoPositions.length - 1) {\r\n      to = incompleteTodoPositions.length - 1;\r\n    }\r\n    if (from === to) {\r\n      return;\r\n    }\r\n    if (to < from) {\r\n      for (let i = to; i < from; i++) {\r\n        arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n      }\r\n    } else {\r\n      for (let i = to; i > from; i--) {\r\n        arraySwap(this._todos, incompleteTodoPositions[from], incompleteTodoPositions[i]);\r\n      }\r\n    }\r\n    function arraySwap(arr: any[], x: number, y: number): void {\r\n      let a = arr[x];\r\n      arr[x] = arr[y];\r\n      arr[y] = a;\r\n    }\r\n  }\r\n\r\n  add(id: TodoIdType, name: string): void {\r\n    let agId = this.id;\r\n    if (!agId) {\r\n      agId = uuid();\r\n      this.applyAndStage(new TodoListCreated(agId));\r\n    }\r\n    this.applyAndStage(new TodoAdded(agId, id, name));\r\n  }\r\n  remove(id: TodoIdType): void {\r\n    if (!this.id || !this._todosMap.has(id)) {\r\n      return;\r\n    }\r\n    this.applyAndStage(new TodoRemoved(this.id, id));\r\n  }\r\n  complete(id: TodoIdType, completionTimestamp: number): void {\r\n    let todo = this._todosMap.get(id);\r\n    if (!this.id || !todo || todo.isCompleted) {\r\n      return;\r\n    }\r\n    this.applyAndStage(new TodoCompleted(this.id, id, completionTimestamp));\r\n  }\r\n  uncomplete(id: TodoIdType): void {\r\n    let todo = this._todosMap.get(id);\r\n    if (!this.id || !todo || !todo.isCompleted) {\r\n      return;\r\n    }\r\n    this.applyAndStage(new TodoUncompleted(this.id, id));\r\n  }\r\n  rename(id: TodoIdType, name: string): void {\r\n    let todo = this._todosMap.get(id);\r\n    if (!this.id || !todo || todo.name === name) {\r\n      return;\r\n    }\r\n    this.applyAndStage(new TodoRenamed(this.id, id, name));\r\n  }\r\n  changePosition(id: TodoIdType, offset: number): void {\r\n    if (!this.id || offset === 0) {\r\n      return;\r\n    }\r\n    let i = this.todos.findIndex(x => x.id === id);\r\n    if (i === -1\r\n      || (i === 0 && offset < 1)\r\n      || (i === this.todos.length - 1 && offset > -1)) {\r\n      return;\r\n    }\r\n    this.applyAndStage(new TodoPositionChanged(this.id, id, offset));\r\n  }\r\n}\r\n","import { DomainEventTypeName, DomainEvent, UncommittedDomainEvent } from \"./events\";\r\n\r\nexport type DomainEventHandler = (e: UncommittedDomainEvent) => void;\r\n\r\nexport abstract class AggregateRoot {\r\n  //[key: string]: any;\r\n  private _uncommittedEvents!: UncommittedDomainEvent[];\r\n  get uncommittedEvents(): UncommittedDomainEvent[] {\r\n    return this._uncommittedEvents;\r\n  }\r\n  protected _id!: string | null;\r\n  get id(): string | null {\r\n    return this._id;\r\n  }\r\n  protected init(): void {\r\n    this._uncommittedEvents = [];\r\n  }\r\n  constructor(events: DomainEvent[]) {\r\n    this.init();\r\n    for (const e of events) {\r\n      this.apply(e);\r\n    }\r\n  }\r\n  private apply(e: UncommittedDomainEvent): void {\r\n    // @ts-ignore\r\n    let handler = this[DomainEventTypeName[e.type]];\r\n    if (handler) {\r\n      (handler as DomainEventHandler).bind(this)(e);\r\n    }\r\n  }\r\n  protected applyAndStage(e: UncommittedDomainEvent): void {\r\n    this.apply(e);\r\n    this._uncommittedEvents.push(e);\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport OnClickOut, { InjectedOnClickOutProps } from \"react-onclickoutside\";\r\n\r\nexport interface TodoActionsPanelBtnGroupProps {\r\n  showDefaultPanel(): void;\r\n}\r\n\r\nclass TodoActionsPanelBtnGroupInner extends React.PureComponent<TodoActionsPanelBtnGroupProps & InjectedOnClickOutProps> {\r\n  handleClickOutside = () => {\r\n    this.props.showDefaultPanel();\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"todo-list-todo-btn-group\">\r\n        <div className=\"btn-group\" role=\"group\">\r\n          {this.props.children}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const TodoActionsPanelBtnGroup = OnClickOut<TodoActionsPanelBtnGroupProps>(TodoActionsPanelBtnGroupInner);\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoDeleteBtnProps {\r\n  deleteTodo(): void;\r\n}\r\n\r\nexport class TodoDeleteBtn extends React.PureComponent<TodoDeleteBtnProps> {\r\n  render() {\r\n    return (\r\n      <button onClick={this.props.deleteTodo} type=\"button\" className=\"btn btn-link\" aria-label=\"Delete\">\r\n        <span className=\"glyphicon glyphicon-trash\" aria-hidden=\"true\" />\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoRenameBtnProps {\r\n  showRenamePanel(): void;\r\n}\r\n\r\nexport class TodoRenameBtn extends React.PureComponent<TodoRenameBtnProps> {\r\n  render() {\r\n    return (\r\n      <button onClick={this.props.showRenamePanel} type=\"button\" className=\"btn btn-link\"  aria-label=\"Rename\">\r\n        <span className=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\" />\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoPanelBtnGroupProps {\r\n  showActionsPanel(): void;\r\n}\r\n\r\nexport class TodoPanelBtnGroup extends React.PureComponent<TodoPanelBtnGroupProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"todo-list-todo-btn-group\">\r\n        <button onClick={this.props.showActionsPanel} type=\"button\" className=\"btn btn-link\" aria-label=\"Actions\">\r\n          <span className=\"glyphicon glyphicon-cog\" aria-hidden=\"true\" />\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport OnClickOut, { InjectedOnClickOutProps } from \"react-onclickoutside\";\r\nimport { Todo } from \"domain/todo\";\r\n\r\nexport interface TodoRenameFormProps {\r\n  todo: Todo;\r\n  renameTodo(name: string): void;\r\n  showDefaultPanel(): void;\r\n}\r\n\r\ninterface TodoRenameFormState {\r\n  value: string;\r\n}\r\n\r\nclass TodoRenameFormInner extends React.PureComponent<TodoRenameFormProps & InjectedOnClickOutProps, TodoRenameFormState> {\r\n  constructor(props: TodoRenameFormProps & InjectedOnClickOutProps) {\r\n    super(props);\r\n    this.state = {\r\n      value: this.props.todo.name,\r\n    };\r\n  }\r\n  handleClickOutside = () => {\r\n    this.props.showDefaultPanel();\r\n  }\r\n  onChange: React.ChangeEventHandler<HTMLInputElement> = e => {\r\n    this.setState({ value: e.target.value });\r\n  }\r\n  onSubmit: React.FormEventHandler<HTMLFormElement> = e => {\r\n    e.preventDefault();\r\n    this.props.renameTodo(this.state.value);\r\n    this.props.showDefaultPanel();\r\n  }\r\n  render() {\r\n    let inputId = \"todoRenameInput-\" + this.props.todo.id;\r\n    return (\r\n      <form role=\"form\" onSubmit={this.onSubmit}>\r\n        <label htmlFor={inputId} className=\"sr-only\">New Name</label>\r\n        <div className=\"input-group\">\r\n          <input id={inputId} name=\"name\" type=\"text\" className=\"form-control\" onChange={this.onChange} value={this.state.value} required maxLength={200} />\r\n          <span className=\"input-group-btn\">\r\n            <button type=\"submit\" className=\"btn btn-success\" aria-label=\"Rename To-do\">\r\n              <span className=\"glyphicon glyphicon-pencil\" aria-hidden=\"true\" />\r\n            </button>\r\n          </span>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n\r\nexport const TodoRenameForm = OnClickOut<TodoRenameFormProps>(TodoRenameFormInner);\r\n","import * as React from \"react\";\r\n\r\nexport interface AlertLoginLinkProps {\r\n  login(rememberMe?: boolean): void\r\n}\r\n\r\nexport class AlertLoginLink extends React.PureComponent<AlertLoginLinkProps> {\r\n  loginClicked = () => {\r\n    this.props.login(false);\r\n  };\r\n  render() {\r\n    return (\r\n      <a role=\"button\" tabIndex={0} onClick={this.loginClicked}>Sign&nbsp;in&nbsp;with&nbsp;Google</a>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport * as ReactDOM from \"react-dom\";\r\nimport * as firebase from \"firebase\";\r\nimport { App } from \"components/app\";\r\nimport \"styles.css\";\r\n\r\n// if (!window.indexedDB) {\r\n//   window.alert(\"Your browser doesn't support IndexedDB (the browser feature this app uses to store your To-dos). Update your browser to its latest version.\");\r\n// }\r\n\r\nfirebase.initializeApp({\r\n  apiKey: \"AIzaSyA39ayMBQy61hI_F12NIVUnjBMnOxeh4NM\",\r\n  authDomain: \"muchdone-daff6.firebaseapp.com\",\r\n  databaseURL: \"https://muchdone-daff6.firebaseio.com\",\r\n  projectId: \"muchdone-daff6\",\r\n  storageBucket: \"muchdone-daff6.appspot.com\",\r\n  messagingSenderId: \"1050428102724\"\r\n});\r\n\r\nReactDOM.render(\r\n  <App/>,\r\n  document.getElementById(\"app\"),\r\n);\r\n","import * as React from \"react\";\r\nimport * as firebase from \"firebase\";\r\nimport { v4 as uuid } from \"uuid\";\r\nimport { Data } from \"data\";\r\nimport { updateUserProfile } from \"data/firebase-rtdb\"\r\nimport { TodoList } from \"domain/todo-list\";\r\nimport { DomainEvent, DomainEventTypeName } from \"domain/events\";\r\nimport { Body } from \"./body\";\r\nimport { TodoIdType } from \"domain/todo\";\r\nimport { Unsub } from \"data/event-store\";\r\nimport { TodoLists } from \"domain/todo-lists\";\r\nimport { FirebaseRTDBEventStore } from \"data/firebase-rtdb-event-store\";\r\nimport { IndexedDBEventStore } from \"data/indexeddb-event-store\";\r\n\r\ninterface AppState {\r\n  todoListId: string | null;\r\n  todoListEvents: DomainEvent[];\r\n  isAuthenticated: boolean;\r\n  authStateWasReceived: boolean;\r\n  indexedDBSupported: boolean;\r\n}\r\n\r\nexport class App extends React.PureComponent<{}, AppState> {\r\n  offAuthStateChanged: firebase.Unsubscribe | null = null;\r\n  offTodoListUpdated: Unsub | null = null;\r\n  offTodoListsUpdated: Unsub | null = null;\r\n  data!: Data;\r\n  constructor(props: {}) {\r\n    super(props);\r\n    this.state = {\r\n      todoListId: null,\r\n      todoListEvents: [],\r\n      isAuthenticated: false,\r\n      authStateWasReceived: false,\r\n      indexedDBSupported: (\"indexedDB\" in window),\r\n    };\r\n  }\r\n  componentDidMount() {\r\n    this.offAuthStateChanged = firebase.auth().onAuthStateChanged(user => {\r\n      console.log(\"onAuthStateChanged\");\r\n      console.log(user);\r\n      this.offTodoListUpdated && this.offTodoListUpdated();\r\n      this.offTodoListsUpdated && this.offTodoListsUpdated();\r\n      if (user) {\r\n        // login\r\n        this.setState({ authStateWasReceived: true, isAuthenticated: true, todoListId: null, todoListEvents: [] });\r\n        this.data = new Data(new FirebaseRTDBEventStore<DomainEventTypeName>());\r\n        this.subscribeToTodoListUpdates(todoListId => {\r\n          if (this.state.indexedDBSupported) {\r\n            this.data.importTodoList(new IndexedDBEventStore<DomainEventTypeName>(\"much-done\", \"event\"), todoListId)\r\n          }\r\n        });\r\n        updateUserProfile().catch(console.log);\r\n      } else {\r\n        // logout\r\n        this.setState({ authStateWasReceived: true, isAuthenticated: false, todoListId: null, todoListEvents: [] });\r\n        if (this.state.indexedDBSupported) {\r\n          this.data = new Data(new IndexedDBEventStore<DomainEventTypeName>(\"much-done\", \"event\"));\r\n          this.subscribeToTodoListUpdates();\r\n        }\r\n      }\r\n    })\r\n  }\r\n  componentWillUnmount() {\r\n    this.offAuthStateChanged && this.offAuthStateChanged();\r\n    this.offTodoListUpdated && this.offTodoListUpdated();\r\n    this.offTodoListsUpdated && this.offTodoListsUpdated();\r\n  }\r\n  subscribeToTodoListUpdates = (onListIdLoaded?: (todoListId: string) => void) => {\r\n    this.offTodoListsUpdated = this.data.onTodoListsUpdated(events => {\r\n      let lists = new TodoLists(events);\r\n      if (!this.state.todoListId && lists.ids.length) {\r\n        // The client had no TodoList and one was created.\r\n        // This should also match when the user signs in because the local todoListId should be cleared.\r\n        this.setState({ todoListId: lists.ids[0] });\r\n        onListIdLoaded && onListIdLoaded(lists.ids[0]);\r\n        this.offTodoListUpdated = this.data.onTodoListUpdated(lists.ids[0], events => this.setState({ todoListEvents: events }));\r\n      } else if (this.state.todoListId && !lists.ids.length) {\r\n        // The client had a TodoList but the default TodoList was deleted.\r\n        this.offTodoListUpdated && this.offTodoListUpdated();\r\n        this.setState({ todoListId: null, todoListEvents: [] });\r\n      } else if (this.state.todoListId && lists.ids.length && this.state.todoListId !== lists.ids[0]) {\r\n        // The client had a TodoList but a different TodoList was made the default.\r\n        this.offTodoListUpdated && this.offTodoListUpdated();\r\n        this.setState({ todoListId: lists.ids[0] });\r\n        this.offTodoListUpdated = this.data.onTodoListUpdated(lists.ids[0], events => this.setState({ todoListEvents: events }));\r\n      }\r\n    });\r\n  }\r\n  login = (rememberMe?: boolean) => {\r\n    let persistence = (rememberMe)\r\n      ? firebase.auth.Auth.Persistence.LOCAL\r\n      : firebase.auth.Auth.Persistence.SESSION;\r\n    firebase.auth().setPersistence(persistence)\r\n      .then(() => {\r\n        firebase.auth().signInWithRedirect(new firebase.auth.GoogleAuthProvider());\r\n      })\r\n      .catch(console.log);\r\n  };\r\n  logout = () => {\r\n    firebase.auth().signOut()\r\n      .catch(console.log);\r\n  };\r\n  commandDomainTodoList = async (command: (todoList: TodoList) => void): Promise<void> => {\r\n    let todoList = new TodoList(this.state.todoListEvents);\r\n    command(todoList);\r\n    if (todoList.uncommittedEvents.length) {\r\n      await this.data.addUncommittedEvents(todoList.uncommittedEvents);\r\n      if (!this.state.todoListId && todoList.id) {\r\n        this.setState({\r\n          todoListId: todoList.id\r\n        });\r\n        this.offTodoListUpdated = this.data.onTodoListUpdated(todoList.id, events => this.setState({ todoListEvents: events }));\r\n      }\r\n    }\r\n  }\r\n  addTodo = (name: string) => {\r\n    this.commandDomainTodoList(list => { list.add(uuid(), name); })\r\n      .catch(console.log);\r\n  }\r\n  completeTodo = (id: TodoIdType) => {\r\n    this.commandDomainTodoList(list => { list.complete(id, Date.now()); })\r\n      .catch(console.log);\r\n  }\r\n  uncompleteTodo = (id: TodoIdType) => {\r\n    this.commandDomainTodoList(list => { list.uncomplete(id); })\r\n      .catch(console.log);\r\n  }\r\n  deleteTodo = (id: TodoIdType) => {\r\n    this.commandDomainTodoList(list => { list.remove(id); })\r\n      .catch(console.log);\r\n  }\r\n  moveTodoUp = (id: TodoIdType) => {\r\n    this.commandDomainTodoList(list => { list.changePosition(id, -1); })\r\n      .catch(console.log);\r\n  }\r\n  moveTodoDown = (id: TodoIdType) => {\r\n    this.commandDomainTodoList(list => { list.changePosition(id, 1); })\r\n      .catch(console.log);\r\n  }\r\n  renameTodo = (id: TodoIdType, name: string) => {\r\n    this.commandDomainTodoList(list => { list.rename(id, name); })\r\n      .catch(console.log);\r\n  }\r\n  render() {\r\n    return (\r\n      <Body\r\n        events={this.state.todoListEvents}\r\n        authStateWasReceived={this.state.authStateWasReceived}\r\n        isAuthenticated={this.state.isAuthenticated}\r\n        indexedDBSupported={this.state.indexedDBSupported}\r\n        login={this.login}\r\n        logout={this.logout}\r\n        addTodo={this.addTodo}\r\n        completeTodo={this.completeTodo}\r\n        uncompleteTodo={this.uncompleteTodo}\r\n        deleteTodo={this.deleteTodo}\r\n        moveTodoUp={this.moveTodoUp}\r\n        moveTodoDown={this.moveTodoDown}\r\n        renameTodo={this.renameTodo}\r\n      />\r\n    );\r\n  }\r\n}\r\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","import { EventStore, SubCallback, Unsub, DeleteableEventStore } from \"data/event-store\";\r\nimport { DomainEventTypeName, UncommittedDomainEvent, DomainEvent } from \"domain/events\";\r\n\r\nexport class Data {\r\n  constructor(readonly eventStore: EventStore<DomainEventTypeName>) { }\r\n  onTodoListUpdated(todoListId: string, callback: SubCallback<DomainEventTypeName>): Unsub {\r\n    return this.eventStore.onEventsByAggregateUpdated(todoListId, callback);\r\n  }\r\n  onTodoListsUpdated(callback: SubCallback<DomainEventTypeName>): Unsub {\r\n    return this.eventStore.onEventsByTypeUpdated(DomainEventTypeName.TodoListCreated, callback);\r\n  }\r\n  async addUncommittedEvents(events: UncommittedDomainEvent[]): Promise<void> {\r\n    return this.eventStore.addUncommittedEvents(events);\r\n  }\r\n  async importTodoList(sourceStore: DeleteableEventStore<DomainEventTypeName>, targetAgId: string): Promise<void> {\r\n    // This method imports all events from the source store into the target aggregate id.\r\n    // For the purpose of importing from the IndexedDB to Firestore this is acceptable\r\n    // as the app currently only stores a single aggregate (the todo list) in the IndexedDB store.\r\n    // If multiple aggregates are intended to be supported in IndexedDB, this method will need to change. \r\n    let events = await sourceStore.getAllEvents();\r\n    if (events.length) {\r\n      await this.eventStore.importEvents(events, targetAgId);\r\n      return sourceStore.deleteEvents();\r\n    }\r\n  }\r\n}","import * as firebase from \"firebase\";\r\n\r\nexport async function updateUserProfile(): Promise<void> {\r\n  let user = firebase.auth().currentUser;\r\n  if (!user) {\r\n    throw new Error(\"updateUserProfile(). User not logged into Firebase.\");\r\n  }\r\n  let providerData = user.providerData[0];\r\n  if (!providerData) {\r\n    throw new Error(\"updateUserProfile(). No providerData.\");\r\n  }\r\n  let profile: any = {};\r\n  profile[providerData.providerId.replace(/\\./g, \",\")] = {\r\n    email: user.email,\r\n    emailVerified: user.emailVerified\r\n  }\r\n  return firebase.database().ref(`/users/${user.uid}/profile`).update(profile);\r\n}\r\n","import * as React from \"react\";\r\nimport { TodoIdType } from \"domain/todo\";\r\nimport { TodoList } from \"domain/todo-list\";\r\nimport { EventList } from \"./event-list\";\r\nimport { EventListEmpty } from \"./event-list-empty\";\r\nimport { HistoryTodoListPanel } from \"./history-todo-list-panel\";\r\nimport { TodoListPanel } from \"./todo-list-panel\";\r\nimport { DomainEvent } from \"domain/events\";\r\nimport { NavLoginBtn } from \"./nav-login-btn\";\r\nimport { NoIndexedDBAlert } from \"./no-indexeddb-alert\";\r\nimport { LocalModeAlert } from \"./local-mode-alert\";\r\n\r\nexport interface BodyProps {\r\n  events: DomainEvent[];\r\n  authStateWasReceived: boolean;\r\n  isAuthenticated: boolean;\r\n  indexedDBSupported: boolean;\r\n  login(rememberMe?: boolean): void;\r\n  logout(): void;\r\n  addTodo(name: string): void;\r\n  completeTodo(id: TodoIdType): void;\r\n  uncompleteTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  moveTodoUp(id: TodoIdType): void;\r\n  moveTodoDown(id: TodoIdType): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\ninterface BodyState {\r\n  history: boolean;\r\n  historyVersion: number;\r\n  showLocalModeAlert: boolean;\r\n}\r\n\r\nexport class Body extends React.PureComponent<BodyProps, BodyState> {\r\n  constructor(props: BodyProps) {\r\n    super(props);\r\n    this.state = {\r\n      history: false,\r\n      historyVersion: 0,\r\n      showLocalModeAlert: true,\r\n    };\r\n  }\r\n  showHistoryVersion = (version: number) => {\r\n    this.setState({ history: true, historyVersion: version });\r\n  }\r\n  showCurrentVersion = () => {\r\n    this.setState({ history: false, historyVersion: 0 });\r\n  }\r\n  hideLocalModeAlert = () => this.setState({ showLocalModeAlert: false });\r\n  render() {\r\n    let todoList = new TodoList(\r\n      this.state.history\r\n        ? this.props.events.filter(x => x.version <= this.state.historyVersion)\r\n        : this.props.events\r\n    );\r\n    return (\r\n      <>\r\n        <div className=\"navbar navbar-default navbar-static-top\">\r\n          <div className=\"container\">\r\n            <div className=\"navbar-header\">\r\n              <span className=\"navbar-brand\"><span className=\"glyphicon glyphicon-check\" aria-hidden=\"true\"></span> MuchDone </span>\r\n            </div>\r\n            <span className=\"navbar-text\">It's a to-do list app.</span>\r\n            {this.props.authStateWasReceived\r\n              ? <NavLoginBtn\r\n                isAuthenticated={this.props.isAuthenticated}\r\n                login={this.props.login}\r\n                logout={this.props.logout} />\r\n              : null\r\n            }\r\n          </div>\r\n        </div>\r\n        <div className=\"container\">\r\n          {!this.props.authStateWasReceived\r\n            ? null\r\n            : !this.props.indexedDBSupported\r\n              ? <NoIndexedDBAlert login={this.props.login} />\r\n              : <>\r\n                {!this.props.isAuthenticated && this.state.showLocalModeAlert\r\n                  ? <LocalModeAlert\r\n                      login={this.props.login}\r\n                      hide={this.hideLocalModeAlert}/>\r\n                  : null\r\n                }\r\n                <div className=\"row\">\r\n                  <div className=\"col-sm-8\">\r\n                    {this.state.history\r\n                      ? <HistoryTodoListPanel\r\n                        todos={todoList.todos}\r\n                        completedTodos={todoList.completedTodos}\r\n                      />\r\n                      : <TodoListPanel\r\n                        todos={todoList.todos}\r\n                        completedTodos={todoList.completedTodos}\r\n                        addTodo={this.props.addTodo}\r\n                        completeTodo={this.props.completeTodo}\r\n                        uncompleteTodo={this.props.uncompleteTodo}\r\n                        deleteTodo={this.props.deleteTodo}\r\n                        moveTodoUp={this.props.moveTodoUp}\r\n                        moveTodoDown={this.props.moveTodoDown}\r\n                        renameTodo={this.props.renameTodo}\r\n                      />\r\n                    }\r\n                  </div>\r\n                  <div className=\"col-sm-4\">\r\n                    <h4>Domain Events</h4>\r\n                    {this.props.events.length\r\n                      ? <EventList\r\n                        disableOnClickOutside={!this.state.history}\r\n                        events={this.props.events}\r\n                        showHistoryVersion={this.showHistoryVersion}\r\n                        showCurrentVersion={this.showCurrentVersion} />\r\n                      : <EventListEmpty />}\r\n                  </div>\r\n                </div>\r\n                </>\r\n          }\r\n          <footer>\r\n            <p>&copy; 2018 - Jon Brian Skog</p>\r\n          </footer>\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport OnClickOut, { InjectedOnClickOutProps } from \"react-onclickoutside\";\r\nimport { EventListItem } from \"./event-list/event-list-item\";\r\nimport { DomainEvent } from \"domain/events\";\r\n\r\nexport interface EventListProps {\r\n  events: DomainEvent[];\r\n  showHistoryVersion(version: number): void;\r\n  showCurrentVersion(): void;\r\n}\r\n\r\nexport class EventListInner extends React.PureComponent<EventListProps & InjectedOnClickOutProps> {\r\n  handleClickOutside = () => {\r\n    this.props.showCurrentVersion();\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"list-group\">\r\n        {this.props.events.map(event =>\r\n          <EventListItem\r\n            key={event.id}\r\n            event={event}\r\n            showHistoryVersion={this.props.showHistoryVersion}\r\n          />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport const EventList = OnClickOut<EventListProps>(EventListInner);\r\n","import * as React from \"react\";\r\nimport { DomainEventTypeName, DomainEvent } from \"domain/events\";\r\n\r\nexport interface EventListItemProps {\r\n  event: DomainEvent;\r\n  showHistoryVersion(version: number): void;\r\n}\r\n\r\nexport class EventListItem extends React.PureComponent<EventListItemProps> {\r\n  showHistory: React.MouseEventHandler<HTMLButtonElement> = e => {\r\n    this.props.showHistoryVersion(this.props.event.version);\r\n  }\r\n  render() {\r\n    return (\r\n      <button onClick={this.showHistory} className=\"list-group-item event-list-item\">{this.props.event.version} : {DomainEventTypeName[this.props.event.type]}</button>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport const EventListEmpty: React.SFC = () =>\r\n  <p><span className=\"glyphicon glyphicon-exclamation-sign\" aria-hidden=\"true\"></span> Add some to-dos to see events</p>;\r\n","import * as React from \"react\";\r\nimport { CompletedTodo, Todo } from \"domain/todo\";\r\nimport { HistoryCompletedTodoList } from \"./history-todo-list-panel/history-completed-todo-list\";\r\nimport { HistoryTodoList } from \"./history-todo-list-panel/history-todo-list\";\r\n\r\nexport interface HistoryTodoListPanelProps {\r\n  todos: Todo[];\r\n  completedTodos: CompletedTodo[];\r\n}\r\n\r\nexport class HistoryTodoListPanel extends React.PureComponent<HistoryTodoListPanelProps> {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <h3 className=\"sr-only\">To-dos</h3>\r\n        <HistoryTodoList todos={this.props.todos} />\r\n        {this.props.completedTodos.length\r\n          ? <div>\r\n            <h3 className=\"sr-only\">Completed To-dos</h3>\r\n            <HistoryCompletedTodoList todos={this.props.completedTodos}\r\n            />\r\n          </div>\r\n          : null\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo } from \"domain/todo\";\r\nimport { HistoryCompletedTodoListItem } from \"./history-completed-todo-list/history-completed-todo-list-item\";\r\n\r\nexport interface HistoryCompletedTodoListProps {\r\n  todos: CompletedTodo[];\r\n}\r\n\r\nexport class HistoryCompletedTodoList extends React.PureComponent<HistoryCompletedTodoListProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group\">\r\n        {this.props.todos.map(todo =>\r\n          <HistoryCompletedTodoListItem\r\n            key={todo.id}\r\n            todo={todo}\r\n          />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo } from \"domain/todo\";\r\nimport { CompletedTodoTitle } from \"components/todo-list-panel/completed-todo-list/completed-todo-list-item/completed-todo-panel/completed-todo-title\";\r\n\r\nexport interface HistoryCompletedTodoListItemProps {\r\n  todo: CompletedTodo;\r\n}\r\n\r\nexport class HistoryCompletedTodoListItem extends React.PureComponent<HistoryCompletedTodoListItemProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item list-group-item-success\">\r\n        <div className=\"todo-list-todo-panel\">\r\n          <CompletedTodoTitle title={this.props.todo.name} completionDate={new Date(this.props.todo.completionTimestamp)} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { HistoryTodoListItem } from \"./history-todo-list/history-todo-list-item\";\r\n\r\nexport interface HistoryTodoListProps {\r\n  todos: Todo[];\r\n}\r\n\r\nexport class HistoryTodoList extends React.PureComponent<HistoryTodoListProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group\">\r\n        {this.props.todos.map(todo =>\r\n          <HistoryTodoListItem\r\n            key={todo.id}\r\n            todo={todo}\r\n          />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { TodoTitle } from \"components/todo-list-panel/todo-list/todo-list-item/todo-panel/todo-title\";\r\n\r\nexport interface HistoryTodoListItemProps {\r\n  todo: Todo;\r\n}\r\n\r\nexport class HistoryTodoListItem extends React.PureComponent<HistoryTodoListItemProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item\">\r\n        <div className=\"todo-list-todo-panel\">\r\n          <TodoTitle title={this.props.todo.name} />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo, Todo, TodoIdType } from \"domain/todo\";\r\nimport { CompletedTodoList } from \"./todo-list-panel/completed-todo-list\";\r\nimport { TodoAddForm } from \"./todo-list-panel/todo-add-form\";\r\nimport { TodoList } from \"./todo-list-panel/todo-list\";\r\n\r\nexport interface TodoListPanelProps {\r\n  todos: Todo[];\r\n  completedTodos: CompletedTodo[];\r\n  addTodo(name: string): void;\r\n  completeTodo(id: TodoIdType): void;\r\n  uncompleteTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  moveTodoUp(id: TodoIdType): void;\r\n  moveTodoDown(id: TodoIdType): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\nexport class TodoListPanel extends React.PureComponent<TodoListPanelProps> {\r\n  render() {\r\n    return (\r\n      <div>\r\n        <TodoAddForm addTodo={this.props.addTodo} />\r\n        <br />\r\n        <h3 className=\"sr-only\">To-dos</h3>\r\n        <TodoList\r\n          todos={this.props.todos}\r\n          completeTodo={this.props.completeTodo}\r\n          deleteTodo={this.props.deleteTodo}\r\n          moveTodoUp={this.props.moveTodoUp}\r\n          moveTodoDown={this.props.moveTodoDown}\r\n          renameTodo={this.props.renameTodo}\r\n        />\r\n        {this.props.completedTodos.length\r\n          ? <div>\r\n            <h3 className=\"sr-only\">Completed To-dos</h3>\r\n            <CompletedTodoList\r\n              todos={this.props.completedTodos}\r\n              uncompleteTodo={this.props.uncompleteTodo}\r\n              deleteTodo={this.props.deleteTodo}\r\n              renameTodo={this.props.renameTodo}\r\n            />\r\n          </div>\r\n          : null\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo, TodoIdType } from \"domain/todo\";\r\nimport { CompletedTodoListItem } from \"./completed-todo-list/completed-todo-list-item\";\r\n\r\nexport interface CompletedTodoListProps {\r\n  todos: CompletedTodo[];\r\n  uncompleteTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\nexport class CompletedTodoList extends React.PureComponent<CompletedTodoListProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group\">\r\n        {this.props.todos.map(todo =>\r\n          <CompletedTodoListItem\r\n            key={todo.id}\r\n            todo={todo}\r\n            uncompleteTodo={this.props.uncompleteTodo}\r\n            deleteTodo={this.props.deleteTodo}\r\n            renameTodo={this.props.renameTodo}\r\n          />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo, TodoIdType } from \"domain/todo\";\r\nimport { CompletedTodoActionsPanel } from \"./completed-todo-list-item/completed-todo-actions-panel\";\r\nimport { CompletedTodoPanel } from \"./completed-todo-list-item/completed-todo-panel\";\r\nimport { CompletedTodoRenamePanel } from \"./completed-todo-list-item/completed-todo-rename-panel\";\r\n\r\nexport interface CompletedTodoListItemProps {\r\n  todo: CompletedTodo;\r\n  uncompleteTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\nenum PanelType {\r\n  DefaultPanel,\r\n  ActionsPanel,\r\n  RenamePanel,\r\n}\r\n\r\ninterface CompletedTodoListItemState {\r\n  panel: PanelType;\r\n}\r\n\r\nexport class CompletedTodoListItem extends React.PureComponent<CompletedTodoListItemProps, CompletedTodoListItemState> {\r\n  constructor(props: CompletedTodoListItemProps) {\r\n    super(props);\r\n    this.state = {\r\n      panel: PanelType.DefaultPanel\r\n    };\r\n  }\r\n  uncompleteTodo = () => {\r\n    this.props.uncompleteTodo(this.props.todo.id);\r\n  }\r\n  deleteTodo = () => {\r\n    this.props.deleteTodo(this.props.todo.id);\r\n  }\r\n  renameTodo = (name: string) => {\r\n    this.props.renameTodo(this.props.todo.id, name);\r\n  }\r\n  showDefaultPanel = () => {\r\n    this.setState({\r\n      panel: PanelType.DefaultPanel\r\n    });\r\n  }\r\n  showActionsPanel = () => {\r\n    this.setState({\r\n      panel: PanelType.ActionsPanel\r\n    });\r\n  }\r\n  showRenamePanel = () => {\r\n    this.setState({\r\n      panel: PanelType.RenamePanel\r\n    });\r\n  }\r\n  render() {\r\n    let panel: JSX.Element | null;\r\n    switch (this.state.panel) {\r\n      case PanelType.DefaultPanel: {\r\n        panel =\r\n          <CompletedTodoPanel\r\n            todo={this.props.todo}\r\n            uncompleteTodo={this.uncompleteTodo}\r\n            showActionsPanel={this.showActionsPanel}\r\n          />;\r\n        break;\r\n      }\r\n      case PanelType.ActionsPanel: {\r\n        panel =\r\n          <CompletedTodoActionsPanel\r\n            todo={this.props.todo}\r\n            deleteTodo={this.deleteTodo}\r\n            showDefaultPanel={this.showDefaultPanel}\r\n            showRenamePanel={this.showRenamePanel}\r\n          />;\r\n        break;\r\n      }\r\n      case PanelType.RenamePanel: {\r\n        panel =\r\n          <CompletedTodoRenamePanel\r\n            todo={this.props.todo}\r\n            renameTodo={this.renameTodo}\r\n            showDefaultPanel={this.showDefaultPanel}\r\n          />;\r\n        break;\r\n      }\r\n      default: {\r\n        panel = null;\r\n        break;\r\n      }\r\n    }\r\n    return panel;\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { CompletedTodo } from \"domain/todo\";\r\nimport { CompletedTodoTitle } from \"./completed-todo-panel/completed-todo-title\";\r\nimport { TodoActionsPanelBtnGroup } from \"components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-actions-panel-btn-group\";\r\nimport { TodoDeleteBtn } from \"components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-delete-btn\";\r\nimport { TodoRenameBtn } from \"components/todo-list-panel/todo-list/todo-list-item/todo-actions-panel/todo-rename-btn\";\r\n\r\nexport interface CompletedTodoActionsPanelProps {\r\n  todo: CompletedTodo;\r\n  deleteTodo(): void;\r\n  showDefaultPanel(): void;\r\n  showRenamePanel(): void;\r\n}\r\n\r\nexport class CompletedTodoActionsPanel extends React.PureComponent<CompletedTodoActionsPanelProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item list-group-item-success\">\r\n        <div className=\"todo-list-todo-panel\">\r\n          <CompletedTodoTitle title={this.props.todo.name} completionDate={new Date(this.props.todo.completionTimestamp)} />\r\n          <TodoActionsPanelBtnGroup showDefaultPanel={this.props.showDefaultPanel}>\r\n            <TodoDeleteBtn deleteTodo={this.props.deleteTodo} />\r\n            <TodoRenameBtn showRenamePanel={this.props.showRenamePanel} />\r\n          </ TodoActionsPanelBtnGroup>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { findDOMNode } from \"react-dom\";\r\nimport { CompletedTodo } from \"domain/todo\";\r\nimport { CompletedTodoTitle } from \"./completed-todo-panel/completed-todo-title\";\r\nimport { TodoPanelBtnGroup } from \"components/todo-list-panel/todo-list/todo-list-item/todo-panel/todo-panel-btn-group\";\r\n\r\nexport interface CompletedTodoPanelProps {\r\n  todo: CompletedTodo;\r\n  uncompleteTodo(): void;\r\n  showActionsPanel(): void;\r\n}\r\n\r\nexport class CompletedTodoPanel extends React.PureComponent<CompletedTodoPanelProps> {\r\n  btnGroup!: HTMLElement;\r\n  btnGroupRef: React.Ref<TodoPanelBtnGroup> = comp => {\r\n    if (comp) {\r\n      this.btnGroup = findDOMNode(comp) as HTMLElement;\r\n    }\r\n  }\r\n  onClick: React.MouseEventHandler<HTMLAnchorElement> = e => {\r\n    if (!this.btnGroup.contains(e.target as HTMLElement)) {\r\n      this.props.uncompleteTodo();\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <a role=\"button\" tabIndex={0} onClick={this.onClick} className=\"list-group-item list-group-item-success\">\r\n        <div className=\"todo-list-todo-panel\">\r\n          <CompletedTodoTitle title={this.props.todo.name} completionDate={new Date(this.props.todo.completionTimestamp)} />\r\n          <TodoPanelBtnGroup\r\n            ref={this.btnGroupRef}\r\n            showActionsPanel={this.props.showActionsPanel} />\r\n        </div>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { TodoRenameForm } from \"components/todo-list-panel/todo-list/todo-list-item/todo-rename-panel/todo-rename-form\";\r\n\r\nexport interface CompletedTodoRenamePanelProps {\r\n  todo: Todo;\r\n  renameTodo(name: string): void;\r\n  showDefaultPanel(): void;\r\n}\r\n\r\nexport class CompletedTodoRenamePanel extends React.PureComponent<CompletedTodoRenamePanelProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item list-group-item-success\">\r\n        <TodoRenameForm {...this.props} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoAddFormProps {\r\n  addTodo(name: string): void;\r\n}\r\n\r\ninterface TodoAddFormState {\r\n  value: string;\r\n}\r\n\r\nexport class TodoAddForm extends React.PureComponent<TodoAddFormProps, TodoAddFormState> {\r\n  constructor(props: TodoAddFormProps) {\r\n    super(props);\r\n    this.state = {\r\n      value: \"\",\r\n    };\r\n  }\r\n  reset = () => {\r\n    this.setState({ value: \"\" });\r\n  }\r\n  onChange: React.ChangeEventHandler<HTMLInputElement> = e => {\r\n    this.setState({ value: e.target.value });\r\n  }\r\n  onSubmit: React.FormEventHandler<HTMLFormElement> = e => {\r\n    e.preventDefault();\r\n    this.props.addTodo(this.state.value);\r\n    this.reset();\r\n  }\r\n  render() {\r\n    let inputId = \"todoAddInput\";\r\n    return (\r\n      <form role=\"form\" onSubmit={this.onSubmit}>\r\n        <label htmlFor={inputId} className=\"sr-only\">New To-do Name</label>\r\n        <div className=\"input-group\">\r\n          <input id={inputId} name=\"name\" type=\"text\" className=\"form-control\" placeholder=\"What do you need to do?\" onChange={this.onChange} value={this.state.value} required  maxLength={200} />\r\n          <span className=\"input-group-btn\">\r\n            <button type=\"submit\" className=\"btn btn-success\" aria-label=\"Add To-do\">\r\n              <span className=\"glyphicon glyphicon-plus\" aria-hidden=\"true\"></span>\r\n            </button>\r\n          </span>\r\n        </div>\r\n      </form>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo, TodoIdType } from \"domain/todo\";\r\nimport { TodoListItem } from \"./todo-list/todo-list-item\";\r\n\r\nexport interface TodoListProps {\r\n  todos: Todo[];\r\n  completeTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  moveTodoUp(id: TodoIdType): void;\r\n  moveTodoDown(id: TodoIdType): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\nexport class TodoList extends React.PureComponent<TodoListProps> {\r\n  movedTodoListItemRef!: React.RefObject<HTMLDivElement> | null;\r\n  movedTodoListItemOffsetTop!: number | null;\r\n  moveTodoUp = (id: TodoIdType, listItemRef: React.RefObject<HTMLDivElement>) => {\r\n    this.setMovedTodoRef(listItemRef);\r\n    this.props.moveTodoUp(id);\r\n  }\r\n  moveTodoDown = (id: TodoIdType, listItemRef: React.RefObject<HTMLDivElement>) => {\r\n    this.setMovedTodoRef(listItemRef);\r\n    this.props.moveTodoDown(id);\r\n  }\r\n  setMovedTodoRef = (listItemRef: React.RefObject<HTMLDivElement>) => {\r\n    this.movedTodoListItemOffsetTop = (listItemRef.current as HTMLDivElement).offsetTop;\r\n    this.movedTodoListItemRef = listItemRef;\r\n  }\r\n  componentDidUpdate() {\r\n    if (this.movedTodoListItemRef) {\r\n      window.scrollBy({\r\n        top: (this.movedTodoListItemRef.current as HTMLDivElement).offsetTop - (this.movedTodoListItemOffsetTop as number),\r\n        behavior: \"instant\",\r\n      });\r\n      this.movedTodoListItemRef = null;\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"list-group\">\r\n        {this.props.todos.map(todo =>\r\n          <TodoListItem\r\n            key={todo.id}\r\n            todo={todo}\r\n            completeTodo={this.props.completeTodo}\r\n            deleteTodo={this.props.deleteTodo}\r\n            moveTodoUp={this.moveTodoUp}\r\n            moveTodoDown={this.moveTodoDown}\r\n            renameTodo={this.props.renameTodo}\r\n          />)}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo, TodoIdType } from \"domain/todo\";\r\nimport { TodoActionsPanel } from \"./todo-list-item/todo-actions-panel\";\r\nimport { TodoPanel } from \"./todo-list-item/todo-panel\";\r\nimport { TodoRenamePanel } from \"./todo-list-item/todo-rename-panel\";\r\n\r\nexport interface TodoListItemProps {\r\n  todo: Todo;\r\n  completeTodo(id: TodoIdType): void;\r\n  deleteTodo(id: TodoIdType): void;\r\n  moveTodoUp(id: TodoIdType, listItemRef: React.RefObject<HTMLDivElement>): void;\r\n  moveTodoDown(id: TodoIdType, listItemRef: React.RefObject<HTMLDivElement>): void;\r\n  renameTodo(id: TodoIdType, name: string): void;\r\n}\r\n\r\nenum PanelType {\r\n  DefaultPanel,\r\n  ActionsPanel,\r\n  RenamePanel,\r\n}\r\n\r\ninterface TodoListItemState {\r\n  panel: PanelType;\r\n}\r\n\r\nexport class TodoListItem extends React.PureComponent<TodoListItemProps, TodoListItemState> {\r\n  constructor(props: TodoListItemProps) {\r\n    super(props);\r\n    this.state = {\r\n      panel: PanelType.DefaultPanel\r\n    };\r\n  }\r\n  completeTodo = () => {\r\n    this.props.completeTodo(this.props.todo.id);\r\n  }\r\n  deleteTodo = () => {\r\n    this.props.deleteTodo(this.props.todo.id);\r\n  }\r\n  moveTodoUp = (listItemRef: React.RefObject<HTMLDivElement>) => {\r\n    this.props.moveTodoUp(this.props.todo.id, listItemRef);\r\n  }\r\n  moveTodoDown = (listItemRef: React.RefObject<HTMLDivElement>) => {\r\n    this.props.moveTodoDown(this.props.todo.id, listItemRef);\r\n  }\r\n  renameTodo = (name: string) => {\r\n    this.props.renameTodo(this.props.todo.id, name);\r\n  }\r\n  showDefaultPanel = () => {\r\n    this.setState({\r\n      panel: PanelType.DefaultPanel\r\n    });\r\n  }\r\n  showActionsPanel = () => {\r\n    this.setState({\r\n      panel: PanelType.ActionsPanel\r\n    });\r\n  }\r\n  showRenamePanel = () => {\r\n    this.setState({\r\n      panel: PanelType.RenamePanel\r\n    });\r\n  }\r\n  render() {\r\n    let panel: JSX.Element | null;\r\n    switch (this.state.panel) {\r\n      case PanelType.DefaultPanel: {\r\n        panel =\r\n          <TodoPanel\r\n            todo={this.props.todo}\r\n            completeTodo={this.completeTodo}\r\n            showActionsPanel={this.showActionsPanel}\r\n          />;\r\n        break;\r\n      }\r\n      case PanelType.ActionsPanel: {\r\n        panel =\r\n          <TodoActionsPanel\r\n            todo={this.props.todo}\r\n            deleteTodo={this.deleteTodo}\r\n            moveTodoUp={this.moveTodoUp}\r\n            moveTodoDown={this.moveTodoDown}\r\n            showDefaultPanel={this.showDefaultPanel}\r\n            showRenamePanel={this.showRenamePanel}\r\n          />;\r\n        break;\r\n      }\r\n      case PanelType.RenamePanel: {\r\n        panel =\r\n          <TodoRenamePanel\r\n            todo={this.props.todo}\r\n            renameTodo={this.renameTodo}\r\n            showDefaultPanel={this.showDefaultPanel}\r\n          />;\r\n        break;\r\n      }\r\n      default: {\r\n        panel = null;\r\n        break;\r\n      }\r\n    }\r\n    return panel;\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { TodoActionsPanelBtnGroup } from \"./todo-actions-panel/todo-actions-panel-btn-group\";\r\nimport { TodoDeleteBtn } from \"./todo-actions-panel/todo-delete-btn\";\r\nimport { TodoMoveDownBtn } from \"./todo-actions-panel/todo-move-down-btn\";\r\nimport { TodoMoveUpBtn } from \"./todo-actions-panel/todo-move-up-btn\";\r\nimport { TodoRenameBtn } from \"./todo-actions-panel/todo-rename-btn\";\r\nimport { TodoTitle } from \"./todo-panel/todo-title\";\r\n\r\nexport interface TodoActionsPanelProps {\r\n  todo: Todo;\r\n  deleteTodo(): void;\r\n  moveTodoUp(listItemRef: React.RefObject<HTMLDivElement>): void;\r\n  moveTodoDown(listItemRef: React.RefObject<HTMLDivElement>): void;\r\n  showDefaultPanel(): void;\r\n  showRenamePanel(): void;\r\n}\r\n\r\nexport class TodoActionsPanel extends React.PureComponent<TodoActionsPanelProps> {\r\n  listItemRef: React.RefObject<HTMLDivElement>;\r\n  constructor(props: TodoActionsPanelProps) {\r\n    super(props);\r\n    this.listItemRef = React.createRef();\r\n  }\r\n  moveTodoUp = () => {\r\n    this.props.moveTodoUp(this.listItemRef);\r\n  }\r\n  moveTodoDown = () => {\r\n    this.props.moveTodoDown(this.listItemRef);\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item\" ref={this.listItemRef}>\r\n        <div className=\"todo-list-todo-panel\">\r\n          <TodoTitle title={this.props.todo.name} />\r\n          <TodoActionsPanelBtnGroup showDefaultPanel={this.props.showDefaultPanel}>\r\n            <TodoDeleteBtn deleteTodo={this.props.deleteTodo} />\r\n            <TodoMoveUpBtn moveTodoUp={this.moveTodoUp} />\r\n            <TodoMoveDownBtn moveTodoDown={this.moveTodoDown} />\r\n            <TodoRenameBtn showRenamePanel={this.props.showRenamePanel} />\r\n          </TodoActionsPanelBtnGroup>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoMoveDownBtnProps {\r\n  moveTodoDown(): void;\r\n}\r\n\r\nexport class TodoMoveDownBtn extends React.PureComponent<TodoMoveDownBtnProps> {\r\n  render() {\r\n    return (\r\n      <button onClick={this.props.moveTodoDown} type=\"button\" className=\"btn btn-link\" aria-label=\"Move down\">\r\n        <span className=\"glyphicon glyphicon-chevron-down\" aria-hidden=\"true\" />\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface TodoMoveUpBtnProps {\r\n  moveTodoUp(): void;\r\n}\r\n\r\nexport class TodoMoveUpBtn extends React.PureComponent<TodoMoveUpBtnProps> {\r\n  render() {\r\n    return (\r\n      <button onClick={this.props.moveTodoUp} type=\"button\" className=\"btn btn-link\" aria-label=\"Move up\">\r\n        <span className=\"glyphicon glyphicon-chevron-up\" aria-hidden=\"true\" />\r\n      </button>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { findDOMNode } from \"react-dom\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { TodoPanelBtnGroup } from \"./todo-panel/todo-panel-btn-group\";\r\nimport { TodoTitle } from \"./todo-panel/todo-title\";\r\n\r\nexport interface TodoPanelProps {\r\n  todo: Todo;\r\n  completeTodo(): void;\r\n  showActionsPanel(): void;\r\n}\r\n\r\nexport class TodoPanel extends React.PureComponent<TodoPanelProps> {\r\n  btnGroup!: HTMLElement;\r\n  btnGroupRef: React.Ref<TodoPanelBtnGroup> = comp => {\r\n    if (comp) {\r\n      this.btnGroup = findDOMNode(comp) as HTMLElement;\r\n    }\r\n  }\r\n  onClick: React.MouseEventHandler<HTMLAnchorElement> = e => {\r\n    if (!this.btnGroup.contains(e.target as HTMLElement)) {\r\n      this.props.completeTodo();\r\n    }\r\n  }\r\n  render() {\r\n    return (\r\n      <a role=\"button\" tabIndex={0} onClick={this.onClick} className=\"list-group-item\">\r\n        <div className=\"todo-list-todo-panel\">\r\n          <TodoTitle title={this.props.todo.name} />\r\n          <TodoPanelBtnGroup\r\n            ref={this.btnGroupRef}\r\n            showActionsPanel={this.props.showActionsPanel} />\r\n        </div>\r\n      </a>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { Todo } from \"domain/todo\";\r\nimport { TodoRenameForm } from \"./todo-rename-panel/todo-rename-form\";\r\n\r\nexport interface TodoRenamePanelProps {\r\n  todo: Todo;\r\n  renameTodo(name: string): void;\r\n  showDefaultPanel(): void;\r\n}\r\n\r\nexport class TodoRenamePanel extends React.PureComponent<TodoRenamePanelProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"list-group-item\">\r\n        <TodoRenameForm {...this.props} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\n\r\nexport interface LoginBtnProps {\r\n  login(rememberMe?: boolean): void\r\n  logout(): void\r\n  isAuthenticated: boolean\r\n}\r\n\r\ninterface LoginBtnState {\r\n  rememberMe: boolean\r\n}\r\n\r\nexport class NavLoginBtn extends React.PureComponent<LoginBtnProps, LoginBtnState> {\r\n  constructor(props: LoginBtnProps) {\r\n    super(props);\r\n    this.state = {\r\n      rememberMe: false\r\n    }\r\n  }\r\n  loginClicked = () => {\r\n    this.props.login(this.state.rememberMe);\r\n  };\r\n  rememberMeChanged = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({ rememberMe: e.target.checked })\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"navbar-right\">\r\n        {(this.props.isAuthenticated)\r\n          ? <button onClick={this.props.logout} type=\"button\" className=\"btn btn-link navbar-btn\">Sign out</button>\r\n          : <>\r\n            <label className=\"checkbox-inline navbar-text\">\r\n              <input type=\"checkbox\" checked={this.state.rememberMe} onChange={this.rememberMeChanged} />\r\n              Remember me\r\n              </label>\r\n            <button onClick={this.loginClicked} type=\"button\" className=\"btn btn-success navbar-btn\">Sign in with Google</button>\r\n          </>\r\n        }\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import * as React from \"react\";\r\nimport { AlertLoginLink } from \"./alert-login-link\";\r\n\r\nexport interface NoIndexedDBAlertProps {\r\n  login(rememberMe?: boolean): void\r\n}\r\n\r\nexport class NoIndexedDBAlert extends React.PureComponent<NoIndexedDBAlertProps> {\r\n  render() {\r\n    return (\r\n      <>\r\n        <div className=\"alert alert-warning no-indexeddb-alert\" role=\"alert\">\r\n          <span className=\"glyphicon glyphicon-exclamation-sign\" aria-hidden=\"true\" /><span>Your browser doesn't support storing your to-dos locally.</span>\r\n        </div>\r\n        <p>You have two options:</p>\r\n        <ol>\r\n          <li><a href=\"https://www.google.com/chrome/\" target=\"_blank\">Get a better browser</a></li>\r\n          <li><AlertLoginLink login={this.props.login} /> to store your todos in the cloud ...which would be a lot cooler.</li>\r\n        </ol>\r\n        <p>You should <strong>really</strong> do both those things.</p>\r\n      </>\r\n    );\r\n  }\r\n}","import * as React from \"react\";\r\nimport { AlertLoginLink } from \"./alert-login-link\";\r\n\r\nexport interface LocalModeAlertProps {\r\n  login(rememberMe?: boolean): void\r\n  hide(): void\r\n}\r\n\r\nexport class LocalModeAlert extends React.PureComponent<LocalModeAlertProps> {\r\n  render() {\r\n    return (\r\n      <div className=\"alert alert-warning alert-dismissible\" role=\"alert\">\r\n        <button type=\"button\" className=\"close\" onClick={this.props.hide} aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\r\n        {/* <h4>You're not signed-in</h4> */}\r\n        <strong>You're not signed-in.</strong> Any to-dos you add will be stored locally; in the browser. This to-do list will only be accessible in this browser, on this device, and may be lost if your browsing data is cleared. <AlertLoginLink login={this.props.login}/> to store your to-dos in the cloud: they'll be available and synced in real-time on all your devices.\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { AggregateRoot } from \"./aggregate-root\";\r\nimport { TodoListCreated } from \"./events\";\r\n\r\nexport class TodoLists extends AggregateRoot {\r\n  protected _ids!: string[];\r\n  get ids(): string[] {\r\n    return this._ids;\r\n  }\r\n  protected init(): void {\r\n    super.init();\r\n    this._ids = [];\r\n  }\r\n\r\n  // Domain Event Handlers\r\n  protected TodoListCreated(e: TodoListCreated): void {\r\n    this._ids.push(e.aggregateId);\r\n  }\r\n}\r\n","import * as firebase from \"firebase\";\r\nimport { ESEvent, EventStore, UncommittedESEvent, SubCallback, Unsub } from \"./event-store\";\r\n\r\nexport class FirebaseRTDBEventStore<T> implements EventStore<T> {\r\n  protected async getEvents(path: string, version?: number): Promise<ESEvent<T>[]> {\r\n    let user = firebase.auth().currentUser;\r\n    if (!user) {\r\n      throw new Error(\"getEvents(). User not logged into Firebase.\");\r\n    }\r\n    let events = [] as ESEvent<T>[];\r\n    let ref: firebase.database.Reference | firebase.database.Query = firebase.database().ref(`/users/${user.uid}/${path}`).orderByChild(\"version\");\r\n    if (version) {\r\n      ref = ref.endAt(version);\r\n    }\r\n    let snap = await ref.once(\"value\");\r\n    snap.forEach(childSnap => {\r\n      events.push(childSnap.val())\r\n    });\r\n    return events;\r\n  }\r\n  async getAllEvents(version?: number): Promise<ESEvent<T>[]> {\r\n    let events = await this.getEvents(\"events\", version);\r\n    return events;\r\n  }\r\n  async getEventsByAggregate(aggregateId: string, version?: number): Promise<ESEvent<T>[]> {\r\n    let events = await this.getEvents(`eventsByAggregate/${aggregateId}`, version);\r\n    return events;\r\n  }\r\n  async getEventsByType(typeId: T, version?: number): Promise<ESEvent<T>[]> {\r\n    let events = await this.getEvents(`eventsByType/${typeId}`, version);\r\n    return events;\r\n  }\r\n  protected onEventsUpdated(path: string, callback: SubCallback<T>): Unsub {\r\n    let user = firebase.auth().currentUser;\r\n    if (!user) {\r\n      throw new Error(\"onEventsUpdated(). User not logged into Firebase.\");\r\n    }\r\n    let ref = firebase.database().ref(`/users/${user.uid}/${path}`);\r\n    let onCallback = ref.on(\"value\", snap => {\r\n      let events = [] as ESEvent<T>[];\r\n      if (snap) {\r\n        snap.forEach(childSnap => {\r\n          events.push(childSnap.val())\r\n        });\r\n      }\r\n      callback(events, off);\r\n    });\r\n    let off = () => {\r\n      // @ts-ignore: The type mismatch for this callback param is Firebase's problem.\r\n      ref.off(\"value\", onCallback)\r\n    };\r\n    return off;\r\n  }\r\n  onEventsByAggregateUpdated(aggregateId: string, callback: SubCallback<T>): Unsub {\r\n    return this.onEventsUpdated(`eventsByAggregate/${aggregateId}`, callback);\r\n  }\r\n  onEventsByTypeUpdated(typeId: T, callback: SubCallback<T>): Unsub {\r\n    return this.onEventsUpdated(`eventsByType/${typeId}`, callback);\r\n  }\r\n  async addEvents(events: (UncommittedESEvent<T>|ESEvent<T>)[]): Promise<void> {\r\n    let user = firebase.auth().currentUser;\r\n    if (!user) {\r\n      throw new Error(\"addEvents(). User not logged into Firebase.\");\r\n    }\r\n    let ref = firebase.database().ref(`/users/${user.uid}`);\r\n    let updates: any = {};\r\n    for (const event of events) {\r\n      let eventRef = ref.child(\"/events\").push();\r\n      let key = eventRef.key;\r\n      updates[`/events/${key}`] = event;\r\n      updates[`/eventsByAggregate/${event.aggregateId}/${key}`] = event;\r\n      updates[`/eventsByType/${event.type}/${key}`] = event;\r\n    }\r\n    return ref.update(updates);\r\n  }\r\n  async addUncommittedEvents(events: UncommittedESEvent<T>[]): Promise<void> {\r\n    return this.addEvents(events.map(event => Object.assign({ version: firebase.database.ServerValue.TIMESTAMP }, event)));\r\n  }\r\n  async importEvents(events: ESEvent<T>[], aggregateId: string): Promise<void> {\r\n    return this.addEvents(events.map(event => Object.assign({}, event, { aggregateId })));\r\n  }\r\n}","import idb, { Cursor, DB } from \"idb\";\r\nimport { ESEvent, SubCallback, Unsub, UncommittedESEvent, DeleteableEventStore } from \"./event-store\";\r\n\r\nconst eventIdPropName = \"id\";\r\nconst versionPropName = \"version\";\r\n\r\ntype SubPredicate<T> = (event: UncommittedESEvent<T>) => boolean;\r\ntype SubAction = () => Promise<void>;\r\ninterface Sub<T> {\r\n  predicate: SubPredicate<T>;\r\n  action: SubAction;\r\n}\r\n\r\nexport class IndexedDBEventStore<T> implements DeleteableEventStore<T> {\r\n  protected _subs = new Map<symbol, Sub<T>>();\r\n  constructor(readonly dbName: string, readonly storeName: string) { }\r\n  protected async open(): Promise<DB> {\r\n    return await idb.open(this.dbName, 1, db => {\r\n      switch (db.oldVersion) {\r\n        case 0:\r\n          let store = db.createObjectStore(this.storeName, { keyPath: eventIdPropName });\r\n          store.createIndex(versionPropName, versionPropName, { unique: false });\r\n      }\r\n    });\r\n  }\r\n  async getAllEvents(version?: number): Promise<ESEvent<T>[]> {\r\n    let db = await this.open();\r\n    let tx = db.transaction(this.storeName);\r\n    let index = tx.objectStore(this.storeName).index(versionPropName);\r\n    return (version)\r\n      ? index.getAll(IDBKeyRange.upperBound(version))\r\n      : index.getAll();\r\n  }\r\n  async getEventsBy(predicate: (event: ESEvent<T>) => boolean, version?: number): Promise<ESEvent<T>[]> {\r\n    let db = await this.open();\r\n    let events = [] as ESEvent<T>[];\r\n    let tx = db.transaction(this.storeName);\r\n    let index = tx.objectStore(this.storeName).index(versionPropName);\r\n    function cursorCallback(cursor: Cursor<ESEvent<T>, number>): void {\r\n      if (!cursor) {\r\n        return;\r\n      }\r\n      let event = cursor.value;\r\n      if (predicate(event)) {\r\n        events.push(event);\r\n      }\r\n      // tslint:disable-next-line:no-floating-promises\r\n      cursor.continue();\r\n    }\r\n    let range = (version)\r\n      ? IDBKeyRange.upperBound(version)\r\n      : null;\r\n    // iterateCursor() should be replaced with usage of openCursor() when \"idb\" decides it is safe to do so.\r\n    index.iterateCursor(range, cursorCallback);\r\n    await tx.complete;\r\n    return events;\r\n  }\r\n  async getEventsByAggregate(aggregateId: string, version?: number): Promise<ESEvent<T>[]> {\r\n    return this.getEventsBy(x => x.aggregateId === aggregateId, version);\r\n  }\r\n  async getEventsByType(typeId: T, version?: number): Promise<ESEvent<T>[]> {\r\n    return this.getEventsBy(x => x.type === typeId, version);\r\n  }\r\n  onEventsByUpdated(predicate: SubPredicate<T>, subResults: () => Promise<ESEvent<T>[]>, callback: SubCallback<T>): Unsub {\r\n    let sym = Symbol();\r\n    let unsub = () => this._subs.delete(sym);\r\n    let action = () => subResults().then(events => callback(events, unsub));\r\n    this._subs.set(sym, {\r\n      predicate,\r\n      action,\r\n    });\r\n    action().catch(console.log);\r\n    return unsub;\r\n  }\r\n  onEventsByAggregateUpdated(aggregateId: string, callback: SubCallback<T>): Unsub {\r\n    return this.onEventsByUpdated(\r\n      // If an event is added to the event store that matches this predicate...\r\n      event => event.aggregateId === aggregateId,\r\n      // send these events...\r\n      () => this.getEventsByAggregate(aggregateId),\r\n      // to this callback.\r\n      callback);\r\n  }\r\n  onEventsByTypeUpdated(typeId: T, callback: SubCallback<T>): Unsub {\r\n    return this.onEventsByUpdated(\r\n      event => event.type === typeId,\r\n      () => this.getEventsByType(typeId),\r\n      callback);\r\n  }\r\n  async triggerSubs(events: (UncommittedESEvent<T>|ESEvent<T>)[]): Promise<void> {\r\n    let triggeredSubActions: SubAction[] = [];\r\n    for (const sub of this._subs.values()) {\r\n      for (const e of events) {\r\n        if (sub.predicate(e)) {\r\n          triggeredSubActions.push(sub.action);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    await Promise.all(triggeredSubActions.map(action => action()));\r\n  }\r\n  async addEvents(events: (UncommittedESEvent<T>|ESEvent<T>)[]): Promise<void> {\r\n    let db = await this.open();\r\n    let tx = db.transaction(this.storeName, \"readwrite\");\r\n    let store = tx.objectStore(this.storeName);\r\n    let addPromises = events.map(event => store.add(event));\r\n    await Promise.all(addPromises);\r\n    await tx.complete;\r\n    return this.triggerSubs(events);\r\n  }\r\n  async addUncommittedEvents(events: UncommittedESEvent<T>[]): Promise<void> {\r\n    return this.addEvents(events.map(event => Object.assign({ version: Date.now() }, event)));\r\n  }\r\n  async importEvents(events: ESEvent<T>[], aggregateId: string): Promise<void> {\r\n    return this.addEvents(events.map(event => Object.assign({}, event, { aggregateId })));\r\n  }\r\n  async deleteEvents(): Promise<void> {\r\n    // This methods does not trigger any subs as it is currently intended to only\r\n    // be used for importing todo lists to Firestore and not while this is the active event store.\r\n    // If you intend to use this method while this event store is active,\r\n    // you should trigger subs for each deleted event.\r\n    let db = await this.open();\r\n    let tx = db.transaction(this.storeName, \"readwrite\");\r\n    await tx.objectStore(this.storeName).clear();\r\n    return tx.complete;\r\n  }\r\n}","'use strict';\n\n(function() {\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  var exp = {\n    open: function(name, version, upgradeCallback) {\n      var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n      var request = p.request;\n\n      if (request) {\n        request.onupgradeneeded = function(event) {\n          if (upgradeCallback) {\n            upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n          }\n        };\n      }\n\n      return p.then(function(db) {\n        return new DB(db);\n      });\n    },\n    delete: function(name) {\n      return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n    }\n  };\n\n  if (typeof module !== 'undefined') {\n    module.exports = exp;\n    module.exports.default = module.exports;\n  }\n  else {\n    self.idb = exp;\n  }\n}());\n"],"sourceRoot":""}